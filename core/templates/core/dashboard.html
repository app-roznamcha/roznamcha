{% extends "core/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_head %}
<style>
  /* Page wrapper */
  .dashboard-page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
  }

  /* Soft background to make cards pop */
  .dashboard-shell {
      background: linear-gradient(180deg, #f8fafc 0%, #ffffff 55%);
      border-radius: 18px;
      padding: 18px 14px 26px;
  }

  .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
  }

  .dashboard-hero{
    width:100%;
    background: linear-gradient(130deg, #ffffff 0%, #f8fbff 100%);
    border:1px solid #dbe5f2;
    border-radius:24px;
    padding:22px 24px;
    box-shadow: 0 14px 28px rgba(15, 23, 42, 0.08);
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:18px;
    flex-wrap:wrap;
  }

  .dashboard-brand{
    display:flex;
    align-items:flex-start;
    gap:16px;
    flex-wrap:wrap;
    flex: 1 1 680px;
    min-width: 280px;
  }

  .dashboard-brand-copy{
    display:flex;
    flex-direction:column;
    gap:8px;
    min-width: 260px;
  }

  .brand-avatar{
    width:70px;
    height:70px;
    border-radius:18px;
    border:1px solid #d1deec;
    background:#ffffff;
    object-fit:cover;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255,255,255,0.85);
  }

  .brand-avatar-fallback{
    width:70px;
    height:70px;
    border-radius:18px;
    border:1px solid #d1deec;
    background: linear-gradient(160deg, #e8f1ff 0%, #f8fbff 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    font-size: 28px;
    color:#2563eb;
    letter-spacing:0.01em;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255,255,255,0.9);
  }

  .dashboard-title {
    margin: 0;
    font-size: 21px;
    font-weight: 850;
    color: #0f172a;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .dashboard-title-muted{
    font-weight:700;
    color:#64748b;
  }

  .dashboard-subtitle {
    margin: 0;
    font-size: 14.5px;
    color: #5f6e82;
    line-height: 1.35;
  }
  .dashboard-subtitle strong {
      font-weight: 700;
      color: #111827;
  }

  .header-dot{
      color:#9ca3af;
      margin: 0 2px;
      font-weight: 700;
  }

  .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
  }

  
  /* Top mini-cards */
  .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr);  /* 3 cards per row */
        gap: 18px;
        margin-bottom: 20px;
        margin-top: 10px;
    }
    @media (max-width: 980px) {
  .dashboard-cards { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px) {
    .dashboard-cards { grid-template-columns: 1fr; }
    }
  .dash-card {
      padding: 18px 20px 17px;
      border-radius: 18px;
      background: linear-gradient(180deg, #ffffff 0%, #fafcff 100%);
      border: 1px solid #dfe7f3;
      box-shadow: 0 12px 22px rgba(15, 23, 42, 0.06);
      text-decoration: none;
      color: inherit;
      transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
      position: relative;
      overflow: hidden;
      min-height: 112px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
  }
  .dash-card::before{
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #dbeafe, #bfdbfe);
  }
  .dashboard-cards .dash-card:nth-child(2n)::before{
      background: linear-gradient(90deg, #d1fae5, #a7f3d0);
  }
  .dashboard-cards .dash-card:nth-child(3n)::before{
      background: linear-gradient(90deg, #ffedd5, #fed7aa);
  }
  .dash-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.1);
      border-color: #cddcf0;
  }
  .dash-card:focus {
      outline: 3px solid rgba(37, 99, 235, 0.18);
      outline-offset: 3px;
  }

  .dash-card-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: #8a94a6;
      margin-bottom: 4px;
      font-weight: 700;
  }

  .dash-card-value {
      font-size: clamp(20px, 2vw, 32px);
      font-weight: 900;
      color: #0f172a;
      letter-spacing: -0.02em;
      line-height: 1.08;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
  }

  .dashboard-main-label {
      margin: 10px 0 12px;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: .12em;
      color:#64748b;
      font-weight: 700;
  }

  /* Section grid */
  .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      align-items: start;
  }

  .dashboard-section {
      background: linear-gradient(180deg, #ffffff 0%, #f9fbff 100%);
      border-radius: 22px;
      border: 1px solid #dbe6f4;
      padding: 20px 20px 18px;
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.07);
      position: relative;
      overflow: hidden;
  }

  .dashboard-section::before{
      content:"";
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:#e2e8f0;
  }

  .dashboard-section h2 {
      margin: 0 0 8px;
      font-size: 20px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #0f172a;
  }

  /* Indicator: will be themed per section */
  .dashboard-section-title-indicator {
      width: 4px;
      height: 22px;
      border-radius: 999px;
      background: #2563eb;
  }

  .dashboard-section p {
      margin: 2px 0 16px;
      color: #64748b;
      font-size: 14px;
      line-height: 1.45;
      font-weight: 500;
  }

  /* --- Button layout --- */
  .button-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 14px;
  }

  .btn-pill {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      width: 100%;
      min-height: 48px;
      padding: 11px 14px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      border: 1px solid #d8e1ed;
      background: #ffffff;
      color: #0f172a;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255,255,255,0.9);
      transition: background 0.16s ease, box-shadow 0.16s ease, transform 0.16s ease, border-color 0.16s ease;
      line-height: 1.25;
  }

  .btn-pill:hover {
      background: #f8fafc;
      box-shadow: 0 10px 18px rgba(15, 23, 42, 0.12);
      transform: translateY(-2px);
      border-color: #b8c6d8;
  }

  .btn-pill:focus {
      outline: 3px solid rgba(37, 99, 235, 0.18);
      outline-offset: 2px;
  }

  .button-row .btn-pill:only-child {
      grid-column: 1 / -1;
  }

  /* ========= Column colour themes ========= */

  /* Column 1: Master Data ‚Äì Blue */
  .section-master .dashboard-section-title-indicator { background: #2563eb; }
  .section-master.dashboard-section::before { background: linear-gradient(90deg, #2563eb, #60a5fa); }
  .section-master .btn-pill {
      border-color: #bfdbfe;
      color: #1e40af;
      background: linear-gradient(180deg, #eff6ff 0%, #e7f0ff 100%);
  }
  .section-master .btn-pill-primary {
      background: linear-gradient(180deg, #2563eb 0%, #1d4ed8 100%);
      border-color: #1d4ed8;
      color: #ffffff;
      font-weight: 800;
  }
  .section-master .btn-pill-primary:hover {
      background: #1d4ed8;
      border-color: #1d4ed8;
  }

  /* Column 2: Transactions ‚Äì Green */
  .section-transactions .dashboard-section-title-indicator { background: #059669; }
  .section-transactions.dashboard-section::before { background: linear-gradient(90deg, #059669, #34d399); }
  .section-transactions .btn-pill {
      border-color: #a7f3d0;
      color: #047857;
      background: linear-gradient(180deg, #ecfdf5 0%, #ddfaee 100%);
  }
  .section-transactions .btn-pill-primary {
      background: linear-gradient(180deg, #059669 0%, #047857 100%);
      border-color: #047857;
      color: #ffffff;
      font-weight: 800;
  }
  .section-transactions .btn-pill-primary:hover {
      background: #047857;
      border-color: #047857;
  }

  /* Column 3: Reports ‚Äì Orange */
  .section-reports .dashboard-section-title-indicator { background: #f97316; }
  .section-reports.dashboard-section::before { background: linear-gradient(90deg, #f97316, #fdba74); }
  .section-reports .btn-pill {
      border-color: #fed7aa;
      color: #c2410c;
      background: linear-gradient(180deg, #fff7ed 0%, #ffedd8 100%);
  }
  .section-reports .btn-pill-primary {
      background: linear-gradient(180deg, #f97316 0%, #ea580c 100%);
      border-color: #ea580c;
      color: #ffffff;
      font-weight: 800;
  }
  .section-reports .btn-pill-primary:hover {
      background: #ea580c;
      border-color: #ea580c;
  }

  /* Small screens: tighten spacing */
  @media (max-width: 520px) {
    .dashboard-title { font-size: 24px; }
    .dashboard-shell { padding: 14px 10px 22px; }
    .button-row { grid-template-columns: 1fr; }
    .btn-pill { max-width: 100%; }
  }

  /* =========================
   Dashboard user dropdown
   (doesn't disappear on hover)
   ========================= */

.user-menu {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.user-trigger {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
}

.user-trigger-name {
  font-weight: 800;
  color: #0f172a;
}

.user-trigger-caret {
  font-size: 12px;
  color: #64748b;
}

/* Hover-bridge so the dropdown doesn't vanish */
.user-menu::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 100%;
  height: 10px;   /* bridge space */
}

/* Dropdown panel */
.user-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  min-width: 220px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
  padding: 8px;
  display: none;
  z-index: 2000;
}

/* Show dropdown when hovering ANY part of menu (trigger+dropdown+bridge) */
.user-menu:hover .user-dropdown {
  display: block;
}

.user-dropdown a {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 10px;
  color: #111827;
  font-weight: 700;
  text-decoration: none;
}

.user-dropdown a:hover {
  background: #f3f4f6;
  text-decoration: none;
}
/* Language toggle */
.lang-toggle{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid #e5e7eb;
  background:#fff;
  font-weight:800;
  font-size:13px;
}

.lang-toggle button{
  border:none;
  background:transparent;
  cursor:pointer;
  font-weight:900;
  padding:4px 8px;
  border-radius:999px;
}

.lang-toggle button.active{
  background:#eff6ff;
  color:#1d4ed8;
}

/* RTL support */
html[dir="rtl"]{
  direction:rtl;
}

html[dir="rtl"] .dashboard-section{
  text-align:right;
}

/* ===== Header meta (professional balance) ===== */
.header-meta{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.header-meta-top{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  gap:6px;
}

.header-meta-bottom{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:2px;
}

.meta-pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:12px;
  border:1px solid #d7e1ef;
  background:#f4f8ff;
  color:#64748b;
  font-size:12.5px;
  font-weight:800;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.8), 0 1px 2px rgba(15, 23, 42, 0.04);
}

.meta-pill strong{
  color:#0f172a;
  font-weight:850;
}

.summary-toggle-btn{
  max-width: none;
  width:auto;
  min-height: 44px;
  padding:10px 18px;
  border-radius:12px;
  border:1px solid #c7d5ea;
  background: linear-gradient(180deg, #ffffff 0%, #f6f9ff 100%);
  font-weight:800;
  color:#1e3a8a;
  box-shadow: 0 8px 16px rgba(15, 23, 42, 0.08);
}

.summary-toggle-btn:hover{
  background:#eff6ff;
  border-color:#93c5fd;
}

.dashboard-hero-actions{
  display:flex;
  align-items:flex-start;
  margin-left:auto;
}

/* Mobile polish */
@media (max-width: 560px){
  .dashboard-title{font-size:22px;}
  .header-meta{gap:8px;}
  .header-meta-bottom{gap:8px;}
  .meta-pill{font-size:12.5px;padding:7px 10px;}
  .dashboard-hero{padding:16px 14px 14px;}
  .dashboard-hero-actions{
    width:100%;
    margin-left:0;
  }
  .summary-toggle-btn{
    width:100%;
    justify-content:center;
  }
  .brand-avatar,.brand-avatar-fallback{width:58px;height:58px;font-size:22px;}
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page">
  <div class="dashboard-shell">

    <div class="dashboard-header">
        <div class="dashboard-hero">
            <div class="dashboard-brand">
                {% if company and company.logo %}
                    <img src="{{ company.logo.url }}"
                        alt="{{ company.name }}"
                        class="brand-avatar">
                    {% else %}
                    <div class="brand-avatar-fallback">
                        SZ
                    </div>
                    {% endif %}
                <div class="dashboard-brand-copy">
                  <h1 class="dashboard-title">
                    {% if company and company.name %}
                        {{ company.name }}
                    {% else %}
                        Dashboard
                      {% endif %}
                      <span class="dashboard-title-muted" data-i18n="dash_suffix">‚Äî Dashboard</span>
                  </h1>

                  <div class="header-meta">

                    <div class="dashboard-subtitle header-meta-top">
                        <span data-i18n="welcome">Welcome</span><span class="header-dot">¬∑</span>
                      {% if is_staff %}
                        <strong>{{ request.user.get_full_name|default:request.user.username }}</strong>
                      {% else %}
                        <span class="user-menu">
                          <span class="user-trigger">
                            <span class="user-trigger-name">{{ request.user.get_full_name|default:request.user.username }}</span>
                            <span class="user-trigger-caret">‚ñæ</span>
                          </span>
                  
                          <span class="user-dropdown">
                            <a href="{% url 'owner_profile_page' %}"><span data-i18n="user_profile">üë§ User Profile</span></a>
                            <a href="{% url 'subscription_page' %}"><span data-i18n="subscription">üí≥ Subscription</span></a>
                  
                            {% if request.user.is_superuser %}
                              <div style="height:1px;background:#e5e7eb;margin:8px 6px;"></div>
                              <a href="{% url 'superadmin_dashboard' %}"><span data-i18n="superadmin_dash">üõ°Ô∏è Super Admin Dashboard</span></a>
                            {% endif %}
                          </span>
                        </span>
                      {% endif %}
                    </div>
                  
                    <div class="header-meta-bottom">
                      <span class="meta-pill">
                        <span>üìÖ</span>
                        <span data-i18n="today">Today</span>:
                        <strong>{{ today }}</strong>
                      </span>
                  
                      <span class="meta-pill">
                        <span>üïí</span>
                        <span data-i18n="time">Time</span>:
                        <strong>{{ now|date:"h:i A" }}</strong> <span>(PKT)</span>
                      </span>
                    </div>
                  
                  </div>
                </div>
            </div>
            {% if not is_staff %}
              <div class="dashboard-hero-actions">
              <button type="button" id="metricsToggle" class="btn-pill summary-toggle-btn">
                <span data-i18n="show_summary">üëÅÔ∏è Show Summary</span>
              </button>
              </div>
            {% endif %}
        </div>
    </div>



    {# ---- Top financial metric cards (Owner/Superadmin only) ---- #}
    {% if not is_staff %}
    <div class="dashboard-cards" id="metricsCards" style="display:none;">

        <div class="dash-card">
            <div class="dash-card-label" data-i18n="cash_balance">Cash / Bank Balance</div>
            <div class="dash-card-value">
                Rs {{ cash_bank_balance|default:0|floatformat:0 }}
            </div>
        </div>

        <div class="dash-card">
            <div class="dash-card-label" data-i18n="month_sales">This Month Sales</div>
            <div class="dash-card-value">Rs {{ month_sales|default:0|floatformat:0 }}</div>
        </div>

        <div class="dash-card">
            <div class="dash-card-label" data-i18n="month_purchases">This Month Purchases</div>
            <div class="dash-card-value">
                Rs {{ month_purchases|default:0|floatformat:0 }}
            </div>
        </div>

        <div class="dash-card">
            <div class="dash-card-label" data-i18n="month_profit">This Month Profit (Simple)</div>
            <div class="dash-card-value">
                Rs {{ month_profit_simple|default:0|floatformat:0 }}
            </div>
        </div>

        <a href="{% url 'customer_balances' %}" class="dash-card">
            <div class="dash-card-label" data-i18n="customer_receivable">
                Customer Receivable
              </div>
            <div class="dash-card-value">
                Rs {{ customer_receivable|default:0|floatformat:0 }}
            </div>
        </a>

        <a href="{% url 'supplier_balances' %}" class="dash-card">
            <div class="dash-card-label" data-i18n="supplier_payable">
                Supplier Payable
              </div>
            <div class="dash-card-value">
                Rs {{ supplier_payable|default:0|floatformat:0 }}
            </div>
        </a>

    </div>
    {% endif %}    
    <h3 class="dashboard-main-label" data-i18n="main_menu">Main Menu</h3>
    
    <div class="dashboard-grid">
    
        {# =========== MASTER DATA =========== #}
        <section class="dashboard-section section-master">
            <h2>
                <span class="dashboard-section-title-indicator"></span>
                <span data-i18n="master_data">üìÅ Master Data</span>
              </h2>
              <p data-i18n="master_desc">Create and manage customers, suppliers, products and accounts.</p>
    
            <div class="button-row">
                <a href="{% url 'customer_create' %}" class="btn-pill btn-pill-primary">
                    <span data-i18n="new_customer">‚ûï New Customer</span>
                  </a>
                {% if not is_staff %}
                  <a href="{% url 'customer_list' %}" class="btn-pill"><span data-i18n="customer_list">üë• Customer List</span></a>
                {% endif %}
            </div>
    
            <div class="button-row">
                <a href="{% url 'supplier_create' %}" class="btn-pill btn-pill-primary"><span data-i18n="new_supplier">‚ûï New Supplier</span></a>
                {% if not is_staff %}
                  <a href="{% url 'supplier_list' %}" class="btn-pill"><span data-i18n="supplier_list">üè≠ Supplier List</span></a>
                {% endif %}
            </div>
    
            <div class="button-row">
                <a href="{% url 'product_create' %}" class="btn-pill btn-pill-primary"><span data-i18n="new_product">‚ûï New Product</span></a>
                {% if not is_staff %}
                  <a href="{% url 'product_list' %}" class="btn-pill"><span data-i18n="product_list">üì¶ Product List</span></a>
                {% endif %}
            </div>
    
            {% if not is_staff %}
            <div class="button-row">
                <a href="{% url 'user_accounts' %}" class="btn-pill"><span data-i18n="bank_cash_accounts">üè¶ Bank &amp; Cash Accounts</span></a>
                <a href="{% url 'account_ledger' %}" class="btn-pill"><span data-i18n="account_ledger">üìí Account Ledger</span></a>
            </div>
            {% endif %}
        </section>
    
        {# =========== TRANSACTIONS =========== #}
        <section class="dashboard-section section-transactions">
            <h2>
                <span class="dashboard-section-title-indicator"></span>
                <span data-i18n="transactions">üí≥ Transactions</span>
            </h2>
            <p data-i18n="transactions_desc">Record daily sales, purchases, customer receipts and supplier payments.</p>
    
            <div class="button-row">
                <a href="{% url 'sales_new' %}" class="btn-pill btn-pill-primary"><span data-i18n="new_sale">‚ûï New Sale</span></a>
                {% if not is_staff %}
                <a href="{% url 'sales_list' %}" class="btn-pill"><span data-i18n="sales_list">üìÑ Sales List</span></a>
                {% endif %}
            </div>
    
            <div class="button-row">
                <a href="{% url 'purchase_new' %}" class="btn-pill btn-pill-primary"><span data-i18n="new_purchase">‚ûï New Purchase</span></a>
                {% if not is_staff %}
                <a href="{% url 'purchase_list' %}" class="btn-pill"><span data-i18n="purchase_list">üì• Purchase List</span></a>
                {% endif %}
            </div>
    
            <div class="button-row">
                <a href="{% url 'sales_return_new' %}" class="btn-pill"><span data-i18n="sales_return">‚Ü©Ô∏è Sales Return (Customer)</span></a>
                <a href="{% url 'purchase_return_new' %}" class="btn-pill"><span data-i18n="purchase_return">‚Ü©Ô∏è Purchase Return (Supplier)</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'payment_new' %}" class="btn-pill"><span data-i18n="new_payment">üí∞ New Payment / Receipt</span></a>

                {% if not is_staff %}
                <a href="{% url 'payments_list' %}" class="btn-pill"><span data-i18n="payments_list">üìÉ Payments &amp; Receipts</span></a>
                {% endif %}

                <a href="{% url 'expenses_page' %}" class="btn-pill">
                  <span data-i18n="daily_expenses">üßæ Daily Expenses</span>
                </a>
                <a href="{% url 'cash_bank_transfer_page' %}" class="btn-pill">
                  <span data-i18n="cash_bank_transfer">üîÅ Cash/Bank Transfer</span>
                </a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'adjustments_page' %}" class="btn-pill"><span data-i18n="adjustments">üßæ Adjustments (Party + Stock)</span></a>
              </div>
        </section>
    
        {# =========== REPORTS & UTILITIES (Owner/Superadmin only) =========== #}
        {% if not is_staff %}
        <section class="dashboard-section section-reports">
            <h2>
                <span class="dashboard-section-title-indicator"></span>
                <span data-i18n="reports">üìä Reports &amp; Utilities</span>
            </h2>
            <p data-i18n="reports_desc">View key reports for stock, balances and financial performance.</p>
    
            <div class="button-row">
                <a href="{% url 'stock_report' %}" class="btn-pill"><span data-i18n="stock_report">üì¶ Stock Report</span></a>
                <a href="{% url 'product_ledger' %}" class="btn-pill"><span data-i18n="product_ledger">üìä Product Ledger</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'day_summary' %}" class="btn-pill"><span data-i18n="day_summary">üìÖ Day Summary</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'customer_balances' %}" class="btn-pill"><span data-i18n="customer_balances">üë§ Customer Balances</span></a>
                <a href="{% url 'supplier_balances' %}" class="btn-pill"><span data-i18n="supplier_balances">üè≠ Supplier Balances</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'customer_ledger' %}" class="btn-pill"><span data-i18n="customer_ledger">üìí Customer Ledger</span></a>
                <a href="{% url 'supplier_ledger' %}" class="btn-pill"><span data-i18n="supplier_ledger">üìï Supplier Ledger</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'trial_balance' %}" class="btn-pill"><span data-i18n="trial_balance">‚öñÔ∏è Trial Balance</span></a>
                <a href="{% url 'profit_loss' %}" class="btn-pill"><span data-i18n="profit_loss">üìà Profit &amp; Loss</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'balance_sheet' %}" class="btn-pill"><span data-i18n="balance_sheet">üßÆ Balance Sheet</span></a>
            </div>
    
            <div class="button-row">
                <a href="{% url 'tax_pack_page' %}" class="btn-pill">
                    <span data-i18n="tax_pack">üßæ Tax Pack</span>
                </a>
            </div>

            <div class="button-row">
                <a href="{% url 'backup_dashboard' %}" class="btn-pill"><span data-i18n="backups">üóÇÔ∏è Backups</span></a>
            </div>
        </section>
        {% endif %}
    
    </div>
</div>
</div>

<script>
  // 1) Register this page's translations into the global i18n store
  window.ROZ_I18N = window.ROZ_I18N || { en: {}, ur: {} };

  const dict = {
    en: {
      dash_suffix: "‚Äî Dashboard",
      welcome: "Welcome",
      today: "Today",

      user_profile: "üë§ User Profile",
      subscription: "üí≥ Subscription",
      superadmin_dash: "üõ°Ô∏è Super Admin Dashboard",

      cash_balance: "Cash / Bank Balance",
      month_sales: "This Month Sales",
      month_purchases: "This Month Purchases",
      month_profit: "This Month Profit (Simple)",
      customer_receivable: "Customer Receivable",
      supplier_payable: "Supplier Payable",

      new_sale: "‚ûï New Sale",
      sales_list: "üìÑ Sales List",
      new_purchase: "‚ûï New Purchase",
      purchase_list: "üì• Purchase List",
      sales_return: "‚Ü©Ô∏è Sales Return (Customer)",
      purchase_return: "‚Ü©Ô∏è Purchase Return (Supplier)",
      new_payment: "üí∞ New Payment / Receipt",
      payments_list: "üìÉ New Payment / Receipt List",
      adjustments: "üßæ Adjustments (Party + Stock)",

      stock_report: "üì¶ Stock Report",
      product_ledger: "üìä Product Ledger",
      day_summary: "üìÖ Day Summary",
      customer_balances: "üë§ Customer Balances",
      supplier_balances: "üè≠ Supplier Balances",
      customer_ledger: "üìí Customer Ledger",
      supplier_ledger: "üìï Supplier Ledger",
      trial_balance: "‚öñÔ∏è Trial Balance",
      profit_loss: "üìà Profit & Loss",
      balance_sheet: "üßÆ Balance Sheet",
      backups: "üóÇÔ∏è Backups",
      main_menu: "Main Menu",
      master_data: "Master Data",
      transactions: "Transactions",
      reports: "Reports & Utilities",

      master_desc: "Create and manage customers, suppliers, products and accounts.",
      transactions_desc: "Record daily sales, purchases, customer receipts and supplier payments.",
      reports_desc: "View key reports for stock, balances and financial performance.",

      new_customer: "‚ûï New Customer",
      customer_list: "üë• Customer List",
      new_supplier: "‚ûï New Supplier",
      supplier_list: "üè≠ Supplier List",
      new_product: "‚ûï New Product",
      product_list: "üì¶ Product List",

      bank_cash_accounts: "üè¶ Bank & Cash Accounts",
      account_ledger: "üìí Account Ledger",
      time: "Time",
      show_summary: "üëÅÔ∏è Show Summary",
      hide_summary: "üôà Hide Summary",
      tax_pack: "üßæ Tax Pack",
      daily_expenses: "üßæ Daily Expenses",
      cash_bank_transfer: "üîÅ Cash/Bank Transfer",
    },
    ur: {
      dash_suffix: "‚Äî ⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à",
      welcome: "ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ",
      today: "ÿ¢ÿ¨",

      user_profile: "üë§ €åŸàÿ≤ÿ± Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ",
      subscription: "üí≥ ÿ≥ÿ®ÿ≥⁄©ÿ±Ÿæÿ¥ŸÜ",
      superadmin_dash: "üõ°Ô∏è ÿ≥Ÿæÿ± ÿß€å⁄àŸÖŸÜ ⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à",

      cash_balance: "⁄©€åÿ¥ / ÿ®€åŸÜ⁄© ÿ®€åŸÑŸÜÿ≥",
      month_sales: "ÿßÿ≥ ŸÖ€Å€åŸÜ€í ⁄©€å ÿ≥€åŸÑÿ≤",
      month_purchases: "ÿßÿ≥ ŸÖ€Å€åŸÜ€í ⁄©€å Ÿæÿ±⁄Ü€åÿ≤",
      month_profit: "ÿßÿ≥ ŸÖ€Å€åŸÜ€í ⁄©ÿß ŸÖŸÜÿßŸÅÿπ (ÿ≥ÿßÿØ€Å)",
      customer_receivable: "⁄©ÿ≥ŸπŸÖÿ± ÿ≥€í ŸàÿµŸàŸÑ€å",
      supplier_payable: "ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©Ÿà ÿßÿØÿßÿ¶€å⁄Ø€å",

      new_sale: "‚ûï ŸÜÿ¶€å ÿ≥€åŸÑ",
      sales_list: "üìÑ ÿ≥€åŸÑÿ≤ ŸÑÿ≥Ÿπ",
      new_purchase: "‚ûï ŸÜÿ¶€å Ÿæÿ±⁄Ü€åÿ≤",
      purchase_list: "üì• Ÿæÿ±⁄Ü€åÿ≤ ŸÑÿ≥Ÿπ",
      sales_return: "‚Ü©Ô∏è ÿ≥€åŸÑÿ≤ ÿ±€åŸπÿ±ŸÜ (⁄©ÿ≥ŸπŸÖÿ±)",
      purchase_return: "‚Ü©Ô∏è Ÿæÿ±⁄Ü€åÿ≤ ÿ±€åŸπÿ±ŸÜ (ÿ≥ŸæŸÑÿßÿ¶ÿ±)",
      new_payment: "üí∞ ŸÜÿ¶€å ÿßÿØÿßÿ¶€å⁄Ø€å / ÿ±ÿ≥€åÿØ",
      payments_list: "üìÉ ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫ ÿßŸàÿ± ÿ±ÿ≥€åÿØ€å⁄∫",
      adjustments: "üßæ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπÿ≥ (Ÿæÿßÿ±Ÿπ€å + ÿßÿ≥Ÿπÿß⁄©)",

      stock_report: "üì¶ ÿßÿ≥Ÿπÿß⁄© ÿ±ŸæŸàÿ±Ÿπ",
      product_ledger: "üìä Ÿæÿ±Ÿà⁄à⁄©Ÿπ ŸÑ€åÿ¨ÿ±",
      day_summary: "üìÖ ÿ±Ÿàÿ≤ÿßŸÜ€Å ÿÆŸÑÿßÿµ€Å",
      customer_balances: "üë§ ⁄©ÿ≥ŸπŸÖÿ± ÿ®€åŸÑŸÜÿ≥",
      supplier_balances: "üè≠ ÿ≥ŸæŸÑÿßÿ¶ÿ± ÿ®€åŸÑŸÜÿ≥",
      customer_ledger: "üìí ⁄©ÿ≥ŸπŸÖÿ± ŸÑ€åÿ¨ÿ±",
      supplier_ledger: "üìï ÿ≥ŸæŸÑÿßÿ¶ÿ± ŸÑ€åÿ¨ÿ±",
      trial_balance: "‚öñÔ∏è Ÿπÿ±ÿßÿ¶ŸÑ ÿ®€åŸÑŸÜÿ≥",
      profit_loss: "üìà ŸÖŸÜÿßŸÅÿπ Ÿà ŸÜŸÇÿµÿßŸÜ",
      balance_sheet: "üßÆ ÿ®€åŸÑŸÜÿ≥ ÿ¥€åŸπ",
      backups: "üóÇÔ∏è ÿ®€å⁄© ÿßŸæÿ≥",
      main_menu: "ŸÖ€åŸÜ ŸÖ€åŸÜŸà",
      master_data: "ŸÖÿßÿ≥Ÿπÿ± ⁄à€åŸπÿß",
      transactions: "Ÿπÿ±ÿßŸÜÿ≤€å⁄©ÿ¥ŸÜÿ≤",
      reports: "ÿ±ŸæŸàÿ±Ÿπÿ≥ ÿßŸàÿ± €åŸàŸπ€åŸÑŸπ€åÿ≤",

      master_desc: "⁄©ÿ≥ŸπŸÖÿ±ÿå ÿ≥ŸæŸÑÿßÿ¶ÿ±ÿå Ÿæÿ±Ÿà⁄à⁄©Ÿπ ÿßŸàÿ± ÿß⁄©ÿßÿ§ŸÜŸπÿ≥ ⁄©ÿß ÿ±€å⁄©ÿßÿ±⁄à ÿ®ŸÜÿßÿ¶€å⁄∫ ÿßŸàÿ± ŸÖ€åŸÜÿ¨ ⁄©ÿ±€å⁄∫€î",
      transactions_desc: "ÿ≥€åŸÑÿ≤ÿå Ÿæÿ±⁄Ü€åÿ≤ÿå ⁄©ÿ≥ŸπŸÖÿ± ÿ±ÿ≥€åÿØ ÿßŸàÿ± ÿ≥ŸæŸÑÿßÿ¶ÿ± Ÿæ€åŸÖŸÜŸπÿ≥ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫€î",
      reports_desc: "ÿßÿ≥Ÿπÿß⁄©ÿå ÿ®€åŸÑŸÜÿ≥ ÿßŸàÿ± ŸÖÿßŸÑ€å ⁄©ÿßÿ±⁄©ÿ±ÿØ⁄Ø€å ⁄©€å ÿ±ŸæŸàÿ±Ÿπÿ≥ ÿØ€å⁄©⁄æ€å⁄∫€î",

      new_customer: "‚ûï ŸÜ€åÿß ⁄©ÿ≥ŸπŸÖÿ±",
      customer_list: "üë• ⁄©ÿ≥ŸπŸÖÿ± ŸÑÿ≥Ÿπ",
      new_supplier: "‚ûï ŸÜ€åÿß ÿ≥ŸæŸÑÿßÿ¶ÿ±",
      supplier_list: "üè≠ ÿ≥ŸæŸÑÿßÿ¶ÿ± ŸÑÿ≥Ÿπ",
      new_product: "‚ûï ŸÜ€åÿß Ÿæÿ±Ÿà⁄à⁄©Ÿπ",
      product_list: "üì¶ Ÿæÿ±Ÿà⁄à⁄©Ÿπ ŸÑÿ≥Ÿπ",

      bank_cash_accounts: "üè¶ ÿ®€åŸÜ⁄© / ⁄©€åÿ¥ ÿß⁄©ÿßÿ§ŸÜŸπÿ≥",
      account_ledger: "üìí ÿß⁄©ÿßÿ§ŸÜŸπ ŸÑ€åÿ¨ÿ±",
      time: "ŸàŸÇÿ™",
      show_summary: "üëÅÔ∏è ÿÆŸÑÿßÿµ€Å ÿØ⁄©⁄æÿßÿ¶€å⁄∫",
      hide_summary: "üôà ÿÆŸÑÿßÿµ€Å ⁄Ü⁄æŸæÿßÿ¶€å⁄∫",
      tax_pack: "üßæ Ÿπ€å⁄©ÿ≥ Ÿæ€å⁄©",
      daily_expenses: "üßæ ÿ±Ÿàÿ≤ÿßŸÜ€Å ÿßÿÆÿ±ÿßÿ¨ÿßÿ™",
      cash_bank_transfer: "üîÅ ⁄©€åÿ¥/ÿ®€åŸÜ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸÅÿ±",
    }
  };

  // merge (do not overwrite other pages)
  Object.assign(window.ROZ_I18N.en, dict.en);
  Object.assign(window.ROZ_I18N.ur, dict.ur);

  // 2) Summary toggle logic (independent of language engine)
  function setMetricsVisibility(show){
    const cards = document.getElementById("metricsCards");
    const btn = document.getElementById("metricsToggle");
    if (!cards || !btn) return;

    cards.style.display = show ? "" : "none";
    localStorage.setItem("roz_metrics_visible", show ? "1" : "0");

    // update label based on current language
    const lang = localStorage.getItem("roz_lang") || "en";
    const key = show ? "hide_summary" : "show_summary";
    const labelEl = btn.querySelector("[data-i18n]");
    const val = (window.ROZ_I18N[lang] || {})[key];
    if (labelEl && val) labelEl.textContent = val;
  }

  document.addEventListener("DOMContentLoaded", () => {
    // apply lang using global base.html function
    if (window.applyLang) {
      window.applyLang(localStorage.getItem("roz_lang") || "en");
    }

    // default metrics visibility
    setMetricsVisibility(localStorage.getItem("roz_metrics_visible") === "1");

    // toggle button
    const toggleBtn = document.getElementById("metricsToggle");
    if (toggleBtn){
      toggleBtn.addEventListener("click", () => {
        const cards = document.getElementById("metricsCards");
        const isHidden = !cards || cards.style.display === "none";
        setMetricsVisibility(isHidden);
      });
    }
  });

  // If language changes (from base header), refresh the metrics label
  window.addEventListener("storage", function(e){
    if (e.key === "roz_lang") {
      setMetricsVisibility(localStorage.getItem("roz_metrics_visible") === "1");
    }
  });
</script>

{% endblock %}
