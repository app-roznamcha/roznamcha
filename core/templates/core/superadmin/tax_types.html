{% extends "core/base.html" %}
{% block title %}Tax Types{% endblock %}

{% block extra_head %}
<style>
  .wrap{max-width:1200px;margin:0 auto;padding:24px 16px 48px;}
  .head{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px;}
  .title{margin:0;font-size:26px;font-weight:900;color:#0f172a;}
  .sub{margin:6px 0 0;font-size:13px;color:#64748b;font-weight:650;}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:14px;}
  @media(max-width:980px){.grid{grid-template-columns:1fr;}}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 10px 26px rgba(15,23,42,.06);overflow:hidden;}
  .card-h{padding:14px 14px;border-bottom:1px solid #e5e7eb;background:#f8fafc;font-weight:900;color:#0f172a;}
  .card-b{padding:14px;}
  table{width:100%;border-collapse:separate;border-spacing:0;min-width:820px;}
  .table-wrap{overflow:auto;}
  th{font-size:12px;letter-spacing:.12em;text-transform:uppercase;color:#64748b;font-weight:900;background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:12px 12px;position:sticky;top:0;z-index:2;text-align:left;}
  td{padding:12px 12px;border-bottom:1px solid #f1f5f9;color:#0f172a;font-weight:650;white-space:nowrap;}
  tr:hover td{background:#fbfdff;}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;font-weight:900;font-size:12px;border:1px solid #e5e7eb;background:#fff;}
  .b-green{background:#ecfdf5;border-color:#a7f3d0;color:#047857;}
  .b-red{background:#fef2f2;border-color:#fecaca;color:#b91c1c;}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;color:#111827;text-decoration:none;font-weight:900;font-size:13px;cursor:pointer;}
  .btn:hover{background:#f3f4f6;text-decoration:none;}
  .btn-danger:hover{background:#fef2f2;border-color:#fecaca;color:#b91c1c;}
  .f{display:grid;gap:10px;}
  .row{display:grid;gap:6px;}
  label{font-weight:900;color:#0f172a;font-size:13px;}
  input, select{padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-weight:650;}
  .muted{color:#64748b;font-weight:700;font-size:12px;}
  .actions{display:flex;gap:8px;flex-wrap:wrap;}
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="head">
    <div>
      <h1 class="title">üßæ Tax Types (Super Admin)</h1>
      <p class="sub">Add, edit, enable/disable, and delete tax types used in Tax Pack reporting.</p>
    </div>
    <div class="actions">
      <a class="btn" href="{% url 'superadmin_dashboard' %}">‚Üê Back to Dashboard</a>
    </div>
  </div>

  <div class="grid">
    <!-- LIST -->
    <div class="card">
      <div class="card-h">All Tax Types</div>
      <div class="card-b">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Code</th>
                <th>Rate %</th>
                <th>Applies</th>
                <th>Status</th>
                <th style="width:1%;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for t in tax_types %}
              <tr>
                <td>{{ t.name }}</td>
                <td><b>{{ t.code }}</b></td>
                <td>{{ t.default_rate }}</td>
                <td>{{ t.get_applies_to_display }}</td>
                <td>
                  {% if t.is_active %}
                    <span class="badge b-green">‚úÖ ACTIVE</span>
                  {% else %}
                    <span class="badge b-red">‚õî INACTIVE</span>
                  {% endif %}
                </td>
                <td>
                  <div class="actions">
                    <a class="btn" href="{% url 'superadmin_tax_types' %}?edit={{ t.id }}">Edit</a>
                    <a class="btn" href="{% url 'superadmin_tax_type_toggle' t.id %}">
                      {% if t.is_active %}Disable{% else %}Enable{% endif %}
                    </a>
                    <form method="post" action="{% url 'superadmin_tax_type_delete' t.id %}" style="display:inline;margin:0;">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger" onclick="return confirm('Delete {{ t.code }}?');">Delete</button>
                    </form>
                  </div>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="muted">No tax types yet.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- FORM -->
    <div class="card">
      <div class="card-h">
        {% if edit_obj %}Edit Tax Type{% else %}Add Tax Type{% endif %}
      </div>
      <div class="card-b">
        <form method="post" class="f">
          {% csrf_token %}
          {% if edit_obj %}
            <input type="hidden" name="tax_id" value="{{ edit_obj.id }}">
          {% endif %}

          <div class="row">
            <label>Name</label>
            <input name="name" value="{% if edit_obj %}{{ edit_obj.name }}{% endif %}" placeholder="e.g. General Sales Tax">
          </div>

          <div class="row">
            <label>Code</label>
            <input name="code" value="{% if edit_obj %}{{ edit_obj.code }}{% endif %}" placeholder="e.g. GST">
            <div class="muted">Must be unique (example: GST, WHT, FURTHER).</div>
          </div>

          <div class="row">
            <label>Default Rate (%)</label>
            <input name="default_rate" value="{% if edit_obj %}{{ edit_obj.default_rate }}{% else %}0.00{% endif %}" placeholder="18.00">
          </div>

          <div class="row">
            <label>Applies To</label>
            <select name="applies_to">
              <option value="SALE" {% if edit_obj and edit_obj.applies_to == "SALE" %}selected{% endif %}>Sale</option>
              <option value="PURCHASE" {% if edit_obj and edit_obj.applies_to == "PURCHASE" %}selected{% endif %}>Purchase</option>
              <option value="BOTH" {% if edit_obj and edit_obj.applies_to == "BOTH" %}selected{% endif %}>Both</option>
            </select>
          </div>

          <div class="row" style="display:flex;gap:10px;align-items:center;">
            <input type="checkbox" name="is_active" id="is_active" {% if not edit_obj or edit_obj.is_active %}checked{% endif %} style="width:18px;height:18px;">
            <label for="is_active" style="margin:0;">Active</label>
          </div>

          <div class="actions">
            <button class="btn" type="submit">{% if edit_obj %}Update{% else %}Create{% endif %}</button>
            {% if edit_obj %}
              <a class="btn" href="{% url 'superadmin_tax_types' %}">Cancel</a>
            {% endif %}
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
{% endblock %}