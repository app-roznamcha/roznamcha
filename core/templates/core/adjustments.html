{% extends "core/base.html" %}
{% block title %}Adjustments{% endblock %}

{% block content %}
<div class="page adj-page">
  <style>
    .adj-page{
      max-width:1120px;
      margin:34px auto 64px;
      padding:0 18px;
      --line:#e2e8f0;
      --ink-900:#0f172a;
      --ink-700:#334155;
      --ink-500:#64748b;
      --primary:#2563eb;
      --primary-dark:#1d4ed8;
      --surface:#ffffff;
    }

    .adj-hero{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:18px;
      flex-wrap:wrap;
      gap:12px;
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px 20px;
      background:
        radial-gradient(900px 260px at -20% -120%, #dbeafe 0%, transparent 58%),
        radial-gradient(700px 220px at 120% -110%, #dcfce7 0%, transparent 56%),
        var(--surface);
      box-shadow:0 10px 24px rgba(15,23,42,.07);
    }

    .adj-title{
      margin:0 0 6px;
      font-size:31px;
      font-weight:800;
      color:var(--ink-900);
      letter-spacing:-.02em;
    }

    .adj-sub{
      margin:0;
      font-size:15px;
      color:#475569;
      line-height:1.55;
      max-width:760px;
    }

    .adj-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }

    .adj-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 16px;
      min-width:140px;
      border-radius:12px;
      font-size:14px;
      font-weight:700;
      text-decoration:none;
      border:1px solid #cbd5e1;
      background:#f8fafc;
      color:#111827;
      white-space:nowrap;
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      cursor:pointer;
    }

    .adj-btn:hover{
      transform:translateY(-1px);
      border-color:#94a3b8;
      box-shadow:0 8px 16px rgba(15,23,42,.08);
    }

    .adj-btn-primary{
      border-color:var(--primary-dark);
      background:linear-gradient(180deg,var(--primary),var(--primary-dark));
      color:#fff;
    }

    .adj-card{
      background:#ffffff;
      border-radius:16px;
      border:1px solid #d1d5db;
      padding:18px 16px 18px;
      box-shadow:0 8px 18px rgba(15,23,42,.06);
    }

    .adj-card + .adj-card{
      margin-top:22px;
    }

    .adj-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:16px;
    }

    .adj-page input,
    .adj-page select{
      border:1px solid #cbd5e1 !important;
      border-radius:10px !important;
      padding:10px 12px !important;
      font-size:14px !important;
      background:#fff !important;
      transition:border-color .14s ease, box-shadow .14s ease;
    }

    .adj-page input:focus,
    .adj-page select:focus{
      outline:none;
      border-color:#93c5fd !important;
      box-shadow:0 0 0 3px rgba(37,99,235,.14);
    }

    .adj-help{
      margin-top:6px;
      font-size:13px;
      color:#6b7280;
    }

    .adj-amount-tools{
      margin-top:8px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .adj-chip{
      border:1px solid #dbeafe;
      background:#eff6ff;
      color:#1d4ed8;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      padding:4px 10px;
      cursor:pointer;
    }

    .adj-toolbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .adj-search{
      min-width:250px;
      max-width:360px;
      flex:1;
    }

    .adj-search label{
      display:block;
      font-size:13px;
      color:#475569;
      margin-bottom:4px;
      font-weight:600;
    }

    .adj-search input{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      font-size:14px;
    }

    .adj-search input:focus{
      outline:none;
      border-color:#93c5fd;
      box-shadow:0 0 0 3px rgba(37,99,235,.14);
    }

    .adj-table-wrap{
      margin-top:12px;
      overflow-x:auto;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#fff;
    }

    .adj-table{
      border-collapse:collapse;
      width:100%;
      min-width:860px;
    }

    .adj-table th,
    .adj-table td{
      border-bottom:1px solid #e5e7eb;
      padding:8px 10px;
      font-size:14px;
      vertical-align:middle;
    }

    .adj-table th{
      background:#f8fafc;
      text-align:left;
      font-weight:700;
      color:#334155;
      text-transform:uppercase;
      letter-spacing:.05em;
      font-size:12px;
      position:sticky;
      top:0;
      z-index:1;
    }

    .adj-table tbody tr:nth-child(even){ background:#fcfdff; }
    .adj-table tbody tr:hover{ background:#f8fbff; }
    .adj-table tbody tr.is-hidden{ display:none; }

    .adj-count{
      font-size:13px;
      color:#64748b;
      font-weight:700;
    }

    @media (max-width:640px){
      .adj-page{padding:0 14px;margin:22px auto 52px;}
      .adj-hero{padding:16px;}
      .adj-title{font-size:25px;}
      .adj-btn{width:100%;}
      .adj-search{min-width:100%;max-width:100%;}
    }
  </style>

  <div class="adj-hero">
    <div>
      <h1 class="adj-title" data-i18n="adj_title">Adjustments</h1>
      <p class="adj-sub">
        <span data-i18n="adj_subtitle">
          Customer/Supplier opening balance corrections (no cash/bank involved). Posts against
        </span>
        <strong>3000 <span data-i18n="opening_balances">Opening Balances</span></strong>.
      </p>
    </div>
    <div class="adj-actions">
      <a href="{% url 'dashboard' %}" class="adj-btn">
        <span data-i18n="back_dashboard">‚Üê Dashboard</span>
      </a>
      <a href="{% url 'payments_list' %}" class="adj-btn adj-btn-primary">
        <span data-i18n="payments">Payments</span>
      </a>
    </div>
  </div>

  {% if error %}
    <div style="margin-bottom:16px;padding:10px 12px;border-radius:10px;
                font-size:15px;background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;">
      {{ error }}
    </div>
  {% endif %}

  {% if messages %}
    <div style="margin-bottom:16px;">
      {% for message in messages %}
        {% if "success" in message.tags %}
          <div style="margin-bottom:10px;padding:10px 12px;border-radius:10px;font-size:15px;
                      background:#dcfce7;color:#166534;border:1px solid #bbf7d0;">
            {{ message }}
          </div>
        {% elif "error" in message.tags %}
          <div style="margin-bottom:10px;padding:10px 12px;border-radius:10px;font-size:15px;
                      background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;">
            {{ message }}
          </div>
        {% else %}
          <div style="margin-bottom:10px;padding:10px 12px;border-radius:10px;font-size:15px;
                      background:#f3f4f6;color:#111827;border:1px solid #e5e7eb;">
            {{ message }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <!-- =========================
       PARTY ADJUSTMENT (FORM)
       ========================= -->
  <div class="adj-card">

    <h2 style="margin:0 0 14px;font-size:20px;font-weight:700;" data-i18n="new_adj">New Adjustment</h2>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="form_type" value="party_adjust">

      <div class="adj-grid">

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="date">Date</label>
          <input type="date" name="date" value="{{ today }}"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="party">Party</label>
          <select name="party" required
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <option value="" data-i18n="select_party">-- Select Party --</option>
            {% for p in parties %}
              <option value="{{ p.id }}" data-ptype="{{ p.party_type }}">{{ p.name }} ({{ p.get_party_type_display }})</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="amount_rs">Amount (Rs)</label>
          <input type="number" id="pa_amount" name="amount" step="0.01" min="0" required>
          <div class="adj-amount-tools">
            <button type="button" class="adj-chip" data-pa-amount="500">+500</button>
            <button type="button" class="adj-chip" data-pa-amount="1000">+1000</button>
            <button type="button" class="adj-chip" data-pa-amount="5000">+5000</button>
            <button type="button" class="adj-chip" data-pa-amount="0">Clear</button>
          </div>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="effect">Effect</label>

          <select name="side" id="pa_side"
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <!-- Default text will be replaced by JS once party type is known -->
            <option value="DR" selected data-i18n="effect_opt_1">Option 1</option>
            <option value="CR" data-i18n="effect_opt_2">Option 2</option>
          </select>

          <div id="pa_effect_line" style="margin-top:8px;font-size:13px;color:#0f172a;font-weight:700;" data-i18n="after_adjustment_dash">
            After this adjustment, ‚Äî
          </div>

          <div class="adj-help" data-i18n="tip_opening_only">
            Tip: This is only an opening balance correction (no cash/bank).
          </div>
        </div>

        <div style="grid-column:1/-1;">
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="note_reason_opt">Note / Reason (optional)</label>
          <input type="text" name="note" maxlength="255"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

      </div>

      <div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap;">
        <button type="submit" class="adj-btn adj-btn-primary">
          <span data-i18n="save_post_adj">üíæ Save &amp; Post Adjustment</span>
        </button>
      </div>
    </form>
  </div>

  <!-- =========================
       PARTY ADJUSTMENT (HISTORY)
       ========================= -->
  <div class="adj-card">
    <div class="adj-toolbar">
      <h2 style="margin:0;font-size:20px;font-weight:700;" data-i18n="adj_history">Adjustment History</h2>
      <div style="font-size:14px;color:#475569;">
        <span data-i18n="total_amount_sum">Total (amount sum):</span>
        <strong>{{ total_adjustments }}</strong>
      </div>
    </div>

    <div class="adj-toolbar" style="margin-bottom:0;">
      <div class="adj-search">
        <label data-i18n="quick_search_adj">Quick Search (party / type / note)</label>
        <input type="text" id="adjHistorySearch" placeholder="Type to filter history...">
      </div>
      <div class="adj-count">Visible: <span id="adjVisibleCount">{{ adjustments|length }}</span></div>
    </div>

    <div class="adj-table-wrap">
      <table class="adj-table">
        <thead>
          <tr>
            <th data-i18n="date">Date</th>
            <th data-i18n="party">Party</th>
            <th data-i18n="type">Type</th>
            <th data-i18n="side">Side</th>
            <th style="text-align:right;" data-i18n="amount">Amount</th>
            <th data-i18n="note">Note</th>
          </tr>
        </thead>
        <tbody>
          {% for a in adjustments %}
            <tr class="adj-history-row">
              <td>{{ a.date }}</td>
              <td>{{ a.party.name }}</td>
              <td>{{ a.party.get_party_type_display }}</td>
              <td>
                {% if a.party.party_type == "CUSTOMER" %}
                  {% if a.adjustment_side == "DR" %}Customer owes MORE{% else %}Customer owes LESS{% endif %}
                {% elif a.party.party_type == "SUPPLIER" %}
                  {% if a.adjustment_side == "DR" %}You owe LESS{% else %}You owe MORE{% endif %}
                {% else %}
                  {{ a.adjustment_side }}
                {% endif %}
              </td>
              <td style="text-align:right;">{{ a.amount }}</td>
              <td style="color:#475569;">{{ a.description|default:"‚Äî" }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" style="padding:14px 9px;text-align:center;color:#6b7280;" data-i18n="no_adjustments_yet">
                No adjustments yet.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p style="margin:12px 0 0;font-size:13px;color:#6b7280;">
      <span data-i18n="posting_rule_party">
        Posting rule: hits Customer Control (1300) or Supplier Control (2100) vs Opening Balances (3000).
      </span>
    </p>
  </div>

  {# ===================== STOCK ADJUSTMENT CARD ===================== #}
  <div class="adj-card">

    <h2 style="margin:0 0 8px;font-size:20px;font-weight:700;" data-i18n="stock_adj">Stock Adjustment</h2>
    <p style="margin:0 0 18px;font-size:15px;color:#475569;" data-i18n="stock_adj_desc">
      Damage/expiry or correction of stock with accounting impact.
    </p>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="form_type" value="stock_adjust">

      <div class="adj-grid">

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="date">Date</label>
          <input type="date" name="date" value="{{ today }}"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="product">Product</label>
          <select name="product" id="sa_product" required
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <option value="" data-i18n="select_product">-- Select Product --</option>
            {% for p in products %}
              <option value="{{ p.id }}"
                      data-cost="{{ p.purchase_price_per_unit|default_if_none:0|floatformat:2 }}">
                {{ p.code }} - {{ p.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="direction">Direction</label>
          <select name="direction" id="sa_direction"
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <option value="DOWN" selected data-i18n="down_damage">DOWN (Damage / Expiry / Loss)</option>
            <option value="UP" data-i18n="up_correction">UP (Extra / Found / Correction)</option>
          </select>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="quantity">Quantity</label>
          <input type="number" name="qty" id="sa_qty" step="0.001" min="0"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="unit_cost_rs">Unit Cost (Rs)</label>
          <input type="number" name="unit_cost" id="sa_unit_cost" step="0.01" min="0"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
          <div class="adj-help" data-i18n="autofill_cost">
            Auto-fills from product purchase price.
          </div>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="total_rs">Total (Rs)</label>
          <input type="text" id="sa_total" readonly
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;background:#f9fafb;">
        </div>

        <div style="grid-column:1/-1;">
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="reason_opt">Reason (optional)</label>
          <input type="text" name="reason" maxlength="255"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

      </div>

      <div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap;">
        <button type="submit" class="adj-btn adj-btn-primary">
          <span data-i18n="save_post_stock">üíæ Save &amp; Post Stock Adjustment</span>
        </button>
      </div>
    </form>
  </div>

  <script>
  (function () {
    const productEl = document.getElementById("sa_product");
    const qtyEl = document.getElementById("sa_qty");
    const unitEl = document.getElementById("sa_unit_cost");
    const totalEl = document.getElementById("sa_total");

    if (!productEl || !qtyEl || !unitEl || !totalEl) return;

    function toNumber(val) {
      const n = parseFloat(val);
      return isNaN(n) ? 0 : n;
    }

    function fmt(n) {
      return (toNumber(n)).toFixed(2);
    }

    function recalc() {
      const qty = toNumber(qtyEl.value);
      const unit = toNumber(unitEl.value);
      totalEl.value = fmt(qty * unit);
    }

    productEl.addEventListener("change", function () {
      const opt = productEl.selectedOptions[0];
      if (!opt) return;

      const cost = opt.dataset.cost;
      if (cost !== undefined && cost !== null && cost !== "") {
        unitEl.value = cost;
      }
      recalc();
    });

    qtyEl.addEventListener("input", recalc);
    unitEl.addEventListener("input", recalc);

    recalc();
  })();
  </script>

  <script>
    (function () {
      const partyEl = document.querySelector('select[name="party"]');
      const amountEl = document.querySelector('input[name="amount"]');
      const sideEl = document.getElementById('pa_side');
      const lineEl = document.getElementById('pa_effect_line');

      if (!partyEl || !amountEl || !sideEl || !lineEl) return;

      function fmtMoney(n) {
        const num = Number(n || 0);
        if (!isFinite(num)) return "0";
        return num.toLocaleString("en-PK", { maximumFractionDigits: 2 });
      }

      function getPartyType() {
        const opt = partyEl.selectedOptions && partyEl.selectedOptions[0];
        const t = (opt && opt.dataset && opt.dataset.ptype) ? String(opt.dataset.ptype).toUpperCase() : "";

        if (t.includes("SUPPLIER")) return "SUPPLIER";
        if (t.includes("CUSTOMER")) return "CUSTOMER";

        if (t === "S") return "SUPPLIER";
        if (t === "C") return "CUSTOMER";

        return "";
      }

      function tr(key, fallback){
        const lang = localStorage.getItem("roz_lang") || "en";
        const pack = (window.ROZ_I18N && window.ROZ_I18N[lang]) ? window.ROZ_I18N[lang] : {};
        return pack[key] || fallback || key;
      }

      function updateLabelsAndLine() {
        const ptype = getPartyType();
        const side = sideEl.value; // DR or CR
        const amt = Number(amountEl.value || 0);

        // Update dropdown labels based on party type
        if (ptype === "CUSTOMER") {
          sideEl.options[0].text = tr("dr_customer_more", "DR ‚Äî Customer will owe you MORE");
          sideEl.options[1].text = tr("cr_customer_less", "CR ‚Äî Customer will owe you LESS");
        } else if (ptype === "SUPPLIER") {
          sideEl.options[0].text = tr("dr_supplier_less", "DR ‚Äî You will owe supplier LESS");
          sideEl.options[1].text = tr("cr_supplier_more", "CR ‚Äî You will owe supplier MORE");
        } else {
          sideEl.options[0].text = tr("effect_choose_party", "Select a party to see the correct effect");
          sideEl.options[1].text = tr("effect_choose_party_2", "Select a party to see the correct effect");
        }

        // Build the clear sentence you want
        if (!ptype || !amt || amt <= 0) {
          lineEl.textContent = tr("after_adjustment_dash", "After this adjustment, ‚Äî");
          return;
        }

        const money = fmtMoney(amt);

        if (ptype === "CUSTOMER") {
          if (side === "DR") lineEl.textContent = tr("after_customer_more", `After this adjustment, customer will owe you Rs ${money} more.`).replace("{money}", money);
          else lineEl.textContent = tr("after_customer_less", `After this adjustment, customer will owe you Rs ${money} less.`).replace("{money}", money);
        } else if (ptype === "SUPPLIER") {
          if (side === "DR") lineEl.textContent = tr("after_supplier_less", `After this adjustment, you will owe the supplier Rs ${money} less.`).replace("{money}", money);
          else lineEl.textContent = tr("after_supplier_more", `After this adjustment, you will owe the supplier Rs ${money} more.`).replace("{money}", money);
        } else {
          lineEl.textContent = tr("after_balance_change", `After this adjustment, balance will change by Rs ${money}.`).replace("{money}", money);
        }
      }

      partyEl.addEventListener("change", updateLabelsAndLine);
      sideEl.addEventListener("change", updateLabelsAndLine);
      amountEl.addEventListener("input", updateLabelsAndLine);

      document.addEventListener("roz:lang-changed", () => updateLabelsAndLine());

      window.addEventListener("storage", (e) => {
        if (e.key === "roz_lang") updateLabelsAndLine();
      });

      updateLabelsAndLine();
    })();
  </script>

  <!-- =========================
       STOCK ADJUSTMENT (HISTORY)
       ========================= -->
  <div class="adj-card">
    <div class="adj-toolbar" style="margin-bottom:0;">
      <h2 style="margin:0;font-size:20px;font-weight:700;" data-i18n="stock_history">Stock Adjustment History</h2>
      <div class="adj-count">Visible: <span id="stockVisibleCount">{{ stock_adjustments|length }}</span></div>
    </div>

    <div class="adj-toolbar" style="margin-bottom:0;">
      <div class="adj-search">
        <label data-i18n="quick_search_stock">Quick Search (product / reason / direction)</label>
        <input type="text" id="stockHistorySearch" placeholder="Type to filter stock history...">
      </div>
    </div>

    <div class="adj-table-wrap">
      <table class="adj-table" style="min-width:900px;">
        <thead>
          <tr>
            <th data-i18n="date">Date</th>
            <th data-i18n="product">Product</th>
            <th data-i18n="direction">Direction</th>
            <th style="text-align:right;" data-i18n="qty">Qty</th>
            <th style="text-align:right;" data-i18n="unit_cost">Unit Cost</th>
            <th style="text-align:right;" data-i18n="amount">Amount</th>
            <th data-i18n="reason">Reason</th>
          </tr>
        </thead>
        <tbody>
          {% for s in stock_adjustments %}
            <tr class="stock-history-row">
              <td>{{ s.date }}</td>
              <td>
                {{ s.product.code }} - {{ s.product.name }}
              </td>
              <td>{{ s.direction }}</td>
              <td style="text-align:right;">{{ s.qty }}</td>
              <td style="text-align:right;">{{ s.unit_cost }}</td>
              <td style="text-align:right;">{{ s.amount }}</td>
              <td style="color:#475569;">{{ s.reason|default:"‚Äî" }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" style="padding:14px 9px;text-align:center;color:#6b7280;" data-i18n="no_stock_adjustments">
                No stock adjustments yet.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p style="margin:12px 0 0;font-size:13px;color:#6b7280;" data-i18n="posting_rule_stock">
      Posting rule: DOWN ‚Üí Dr Inventory Write-off (5100) / Cr Inventory (1400), UP ‚Üí Dr Inventory (1400) / Cr Opening Balances (3000).
    </p>
  </div>

</div>

<script>
  // Page dictionary: extend global ROZ_I18N without touching base
  window.ROZ_I18N = window.ROZ_I18N || { en: {}, ur: {} };

  Object.assign(window.ROZ_I18N.en, {
    adj_title: "Adjustments",
    adj_subtitle: "Customer/Supplier opening balance corrections (no cash/bank involved). Posts against",
    opening_balances: "Opening Balances",
    back_dashboard: "‚Üê Dashboard",
    payments: "Payments",

    new_adj: "New Adjustment",
    date: "Date",
    party: "Party",
    select_party: "-- Select Party --",
    amount_rs: "Amount (Rs)",
    effect: "Effect",
    increase_adds: "Increase (adds to balance)",
    decrease_reduces: "Decrease (reduces balance)",
    after_adjustment_dash: "After this adjustment, ‚Äî",
    tip_opening_only: "Tip: This is only an opening balance correction (no cash/bank).",
    note_reason_opt: "Note / Reason (optional)",
    save_post_adj: "üíæ Save & Post Adjustment",

    adj_history: "Adjustment History",
    total_amount_sum: "Total (amount sum):",
    type: "Type",
    side: "Side",
    amount: "Amount",
    note: "Note",
    no_adjustments_yet: "No adjustments yet.",
    posting_rule_party: "Posting rule: hits Customer Control (1300) or Supplier Control (2100) vs Opening Balances (3000).",
    quick_search_adj: "Quick Search (party / type / note)",

    stock_adj: "Stock Adjustment",
    stock_adj_desc: "Damage/expiry or correction of stock with accounting impact.",
    product: "Product",
    select_product: "-- Select Product --",
    direction: "Direction",
    down_damage: "DOWN (Damage / Expiry / Loss)",
    up_correction: "UP (Extra / Found / Correction)",
    quantity: "Quantity",
    unit_cost_rs: "Unit Cost (Rs)",
    autofill_cost: "Auto-fills from product purchase price.",
    total_rs: "Total (Rs)",
    reason_opt: "Reason (optional)",
    save_post_stock: "üíæ Save & Post Stock Adjustment",

    stock_history: "Stock Adjustment History",
    qty: "Qty",
    unit_cost: "Unit Cost",
    reason: "Reason",
    no_stock_adjustments: "No stock adjustments yet.",
    posting_rule_stock: "Posting rule: DOWN ‚Üí Dr Inventory Write-off (5100) / Cr Inventory (1400), UP ‚Üí Dr Inventory (1400) / Cr Opening Balances (3000).",
    quick_search_stock: "Quick Search (product / reason / direction)",

    // JS dynamic labels/sentences
    dr_customer_more: "DR ‚Äî Customer will owe you MORE",
    cr_customer_less: "CR ‚Äî Customer will owe you LESS",
    dr_supplier_less: "DR ‚Äî You will owe supplier LESS",
    cr_supplier_more: "CR ‚Äî You will owe supplier MORE",
    dr_increase_adds: "DR ‚Äî Increase (adds to balance)",
    cr_decrease_reduces: "CR ‚Äî Decrease (reduces balance)",
    after_customer_more: "After this adjustment, customer will owe you Rs {money} more.",
    after_customer_less: "After this adjustment, customer will owe you Rs {money} less.",
    after_supplier_less: "After this adjustment, you will owe the supplier Rs {money} less.",
    after_supplier_more: "After this adjustment, you will owe the supplier Rs {money} more.",
    after_balance_change: "After this adjustment, balance will change by Rs {money}.",
    effect_opt_1: "Option 1",
    effect_opt_2: "Option 2",
    effect_choose_party: "Select a party to see the correct effect",
    effect_choose_party_2: "Select a party to see the correct effect",
  });

  Object.assign(window.ROZ_I18N.ur, {
    adj_title: "ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπÿ≥",
    adj_subtitle: "⁄©ÿ≥ŸπŸÖÿ±/ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©€å ÿßŸàŸæŸÜŸÜ⁄Ø ÿ®€åŸÑŸÜÿ≥ ⁄©€å ÿØÿ±ÿ≥ÿ™⁄Ø€å (⁄©€åÿ¥/ÿ®€åŸÜ⁄© ÿ¥ÿßŸÖŸÑ ŸÜ€Å€å⁄∫)€î €å€Å ŸæŸàÿ≥Ÿπ €ÅŸàÿ™ÿß €Å€í",
    opening_balances: "ÿßŸàŸæŸÜŸÜ⁄Ø ÿ®€åŸÑŸÜÿ≥",
    back_dashboard: "‚Üê ⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à",
    payments: "ÿßÿØÿßÿ¶€å⁄Ø€åÿß⁄∫",

    new_adj: "ŸÜÿ¶€å ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ",
    date: "ÿ™ÿßÿ±€åÿÆ",
    party: "Ÿæÿßÿ±Ÿπ€å",
    select_party: "-- Ÿæÿßÿ±Ÿπ€å ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫ --",
    amount_rs: "ÿ±ŸÇŸÖ (ÿ±ŸàŸæ€í)",
    effect: "ÿßÿ´ÿ±",
    increase_adds: "ÿßÿ∂ÿßŸÅ€Å (ÿ®€åŸÑŸÜÿ≥ ÿ®⁄ë⁄æÿ™ÿß €Å€í)",
    decrease_reduces: "⁄©ŸÖ€å (ÿ®€åŸÑŸÜÿ≥ ⁄Ø⁄æŸπÿ™ÿß €Å€í)",
    after_adjustment_dash: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ‚Äî",
    tip_opening_only: "ŸπŸêŸæ: €å€Å ÿµÿ±ŸÅ ÿßŸàŸæŸÜŸÜ⁄Ø ÿ®€åŸÑŸÜÿ≥ ⁄©€å ÿØÿ±ÿ≥ÿ™⁄Ø€å €Å€í (⁄©€åÿ¥/ÿ®€åŸÜ⁄© ÿ¥ÿßŸÖŸÑ ŸÜ€Å€å⁄∫)€î",
    note_reason_opt: "ŸÜŸàŸπ / Ÿàÿ¨€Å (ÿßÿÆÿ™€åÿßÿ±€å)",
    save_post_adj: "üíæ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ŸæŸàÿ≥Ÿπ ⁄©ÿ±€å⁄∫",

    adj_history: "ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ €Åÿ≥Ÿπÿ±€å",
    total_amount_sum: "⁄©ŸÑ (ÿ±ŸÇŸÖ ⁄©ÿß ŸÖÿ¨ŸÖŸàÿπ€Å):",
    type: "ŸÇÿ≥ŸÖ",
    side: "ÿ≥ÿßÿ¶€å⁄à",
    amount: "ÿ±ŸÇŸÖ",
    note: "ŸÜŸàŸπ",
    no_adjustments_yet: "ÿßÿ®⁄æ€å ÿ™⁄© ⁄©Ÿàÿ¶€å ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ŸÜ€Å€å⁄∫€î",
    posting_rule_party: "ŸæŸàÿ≥ŸπŸÜ⁄Ø ÿ±ŸàŸÑ: ⁄©ÿ≥ŸπŸÖÿ± ⁄©ŸÜŸπÿ±ŸàŸÑ (1300) €åÿß ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©ŸÜŸπÿ±ŸàŸÑ (2100) ÿ®ŸÖŸÇÿßÿ®ŸÑ€Å ÿßŸàŸæŸÜŸÜ⁄Ø ÿ®€åŸÑŸÜÿ≥ (3000)€î",
    quick_search_adj: "ŸÅŸàÿ±€å ÿ™ŸÑÿßÿ¥ (Ÿæÿßÿ±Ÿπ€å / ŸÇÿ≥ŸÖ / ŸÜŸàŸπ)",

    stock_adj: "ÿßÿ≥Ÿπÿß⁄© ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ",
    stock_adj_desc: "ŸÜŸÇÿµÿßŸÜ/ÿß€å⁄©ÿ≥Ÿæÿßÿ¶ÿ±€å €åÿß ÿßÿ≥Ÿπÿß⁄© ⁄©€å ÿØÿ±ÿ≥ÿ™⁄Ø€å (ÿß⁄©ÿßÿ§ŸÜŸπŸÜ⁄Ø ÿßÿ´ÿ± ⁄©€í ÿ≥ÿßÿ™⁄æ)€î",
    product: "Ÿæÿ±Ÿà⁄à⁄©Ÿπ",
    select_product: "-- Ÿæÿ±Ÿà⁄à⁄©Ÿπ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫ --",
    direction: "⁄àÿßÿ¶ÿ±€å⁄©ÿ¥ŸÜ",
    down_damage: "DOWN (ŸÜŸÇÿµÿßŸÜ / ÿß€å⁄©ÿ≥Ÿæÿßÿ¶ÿ±€å / ⁄©ŸÖ€å)",
    up_correction: "UP (ÿßÿ∂ÿßŸÅ€å / ŸÖŸÑÿß / ÿØÿ±ÿ≥ÿ™⁄Ø€å)",
    quantity: "ŸÖŸÇÿØÿßÿ±",
    unit_cost_rs: "ŸÅ€å €åŸàŸÜŸπ ŸÇ€åŸÖÿ™ (ÿ±ŸàŸæ€í)",
    autofill_cost: "€å€Å Ÿæÿ±Ÿà⁄à⁄©Ÿπ ⁄©€å Ÿæÿ±⁄Ü€åÿ≤ Ÿæÿ±ÿßÿ¶ÿ≥ ÿ≥€í ÿÆŸàÿØ⁄©ÿßÿ± ÿ®⁄æÿ± ÿ¨ÿßÿ¶€í ⁄Ø€å€î",
    total_rs: "⁄©ŸÑ (ÿ±ŸàŸæ€í)",
    reason_opt: "Ÿàÿ¨€Å (ÿßÿÆÿ™€åÿßÿ±€å)",
    save_post_stock: "üíæ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿßÿ≥Ÿπÿß⁄© ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ŸæŸàÿ≥Ÿπ ⁄©ÿ±€å⁄∫",

    stock_history: "ÿßÿ≥Ÿπÿß⁄© ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ €Åÿ≥Ÿπÿ±€å",
    qty: "ŸÖŸÇÿØÿßÿ±",
    unit_cost: "ŸÅ€å €åŸàŸÜŸπ ŸÇ€åŸÖÿ™",
    reason: "Ÿàÿ¨€Å",
    no_stock_adjustments: "ÿßÿ®⁄æ€å ÿ™⁄© ⁄©Ÿàÿ¶€å ÿßÿ≥Ÿπÿß⁄© ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ŸÜ€Å€å⁄∫€î",
    posting_rule_stock: "ŸæŸàÿ≥ŸπŸÜ⁄Ø ÿ±ŸàŸÑ: DOWN ‚Üí Dr Inventory Write-off (5100) / Cr Inventory (1400)ÿå UP ‚Üí Dr Inventory (1400) / Cr Opening Balances (3000)€î",
    quick_search_stock: "ŸÅŸàÿ±€å ÿ™ŸÑÿßÿ¥ (Ÿæÿ±Ÿà⁄à⁄©Ÿπ / Ÿàÿ¨€Å / ⁄àÿßÿ¶ÿ±€å⁄©ÿ¥ŸÜ)",

    // JS dynamic labels/sentences
    dr_customer_more: "DR ‚Äî ⁄©ÿ≥ŸπŸÖÿ± ÿ¢Ÿæ ⁄©Ÿà ÿ≤€åÿßÿØ€Å ÿØ€í ⁄Øÿß",
    cr_customer_less: "CR ‚Äî ⁄©ÿ≥ŸπŸÖÿ± ÿ¢Ÿæ ⁄©Ÿà ⁄©ŸÖ ÿØ€í ⁄Øÿß",
    dr_supplier_less: "DR ‚Äî ÿ¢Ÿæ ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©Ÿà ⁄©ŸÖ ÿØ€å⁄∫ ⁄Ø€í",
    cr_supplier_more: "CR ‚Äî ÿ¢Ÿæ ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©Ÿà ÿ≤€åÿßÿØ€Å ÿØ€å⁄∫ ⁄Ø€í",
    dr_increase_adds: "DR ‚Äî ÿßÿ∂ÿßŸÅ€Å (ÿ®€åŸÑŸÜÿ≥ ÿ®⁄ë⁄æÿ™ÿß €Å€í)",
    cr_decrease_reduces: "CR ‚Äî ⁄©ŸÖ€å (ÿ®€åŸÑŸÜÿ≥ ⁄Ø⁄æŸπÿ™ÿß €Å€í)",
    after_customer_more: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ⁄©ÿ≥ŸπŸÖÿ± ÿ¢Ÿæ ⁄©Ÿà Rs {money} ÿ≤€åÿßÿØ€Å ÿØ€í ⁄Øÿß€î",
    after_customer_less: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ⁄©ÿ≥ŸπŸÖÿ± ÿ¢Ÿæ ⁄©Ÿà Rs {money} ⁄©ŸÖ ÿØ€í ⁄Øÿß€î",
    after_supplier_less: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ÿ¢Ÿæ ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©Ÿà Rs {money} ⁄©ŸÖ ÿØ€å⁄∫ ⁄Ø€í€î",
    after_supplier_more: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ÿ¢Ÿæ ÿ≥ŸæŸÑÿßÿ¶ÿ± ⁄©Ÿà Rs {money} ÿ≤€åÿßÿØ€Å ÿØ€å⁄∫ ⁄Ø€í€î",
    after_balance_change: "ÿßÿ≥ ÿß€å⁄àÿ¨ÿ≥ŸπŸÖŸÜŸπ ⁄©€í ÿ®ÿπÿØ ÿ®€åŸÑŸÜÿ≥ ŸÖ€å⁄∫ Rs {money} ⁄©€å ÿ™ÿ®ÿØ€åŸÑ€å €ÅŸà⁄Ø€å€î",
    effect_opt_1: "ÿ¢Ÿæÿ¥ŸÜ 1",
    effect_opt_2: "ÿ¢Ÿæÿ¥ŸÜ 2",
    effect_choose_party: "ÿØÿ±ÿ≥ÿ™ ÿßÿ´ÿ± ÿØ€å⁄©⁄æŸÜ€í ⁄©€åŸÑÿ¶€í Ÿæÿßÿ±Ÿπ€å ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫",
    effect_choose_party_2: "ÿØÿ±ÿ≥ÿ™ ÿßÿ´ÿ± ÿØ€å⁄©⁄æŸÜ€í ⁄©€åŸÑÿ¶€í Ÿæÿßÿ±Ÿπ€å ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫",
  });

  // Apply current language to this page after dict is loaded
  if (window.applyLang) window.applyLang(localStorage.getItem("roz_lang") || "en");

  (function () {
    const paAmount = document.getElementById("pa_amount");
    const paChips = document.querySelectorAll("[data-pa-amount]");
    paChips.forEach((chip) => {
      chip.addEventListener("click", () => {
        if (!paAmount) return;
        const val = parseFloat(chip.getAttribute("data-pa-amount") || "0") || 0;
        paAmount.value = val === 0 ? "" : String(val);
        paAmount.dispatchEvent(new Event("input", { bubbles: true }));
      });
    });

    const adjSearch = document.getElementById("adjHistorySearch");
    const adjRows = Array.from(document.querySelectorAll("tr.adj-history-row"));
    const adjCount = document.getElementById("adjVisibleCount");

    function filterAdjRows() {
      const q = ((adjSearch && adjSearch.value) || "").trim().toLowerCase();
      let visible = 0;
      adjRows.forEach((row) => {
        const txt = (row.textContent || "").toLowerCase();
        const ok = !q || txt.includes(q);
        row.classList.toggle("is-hidden", !ok);
        if (ok) visible += 1;
      });
      if (adjCount) adjCount.textContent = String(visible);
    }
    if (adjSearch) adjSearch.addEventListener("input", filterAdjRows);

    const stockSearch = document.getElementById("stockHistorySearch");
    const stockRows = Array.from(document.querySelectorAll("tr.stock-history-row"));
    const stockCount = document.getElementById("stockVisibleCount");

    function filterStockRows() {
      const q = ((stockSearch && stockSearch.value) || "").trim().toLowerCase();
      let visible = 0;
      stockRows.forEach((row) => {
        const txt = (row.textContent || "").toLowerCase();
        const ok = !q || txt.includes(q);
        row.classList.toggle("is-hidden", !ok);
        if (ok) visible += 1;
      });
      if (stockCount) stockCount.textContent = String(visible);
    }
    if (stockSearch) stockSearch.addEventListener("input", filterStockRows);
  })();
</script>

{% endblock %}
