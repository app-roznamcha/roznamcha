{% extends "core/base.html" %}

{% block title %}Backups{% endblock %}

{% block content %}
<div class="page" style="max-width:900px;margin:40px auto 60px;padding:0 26px;">

  {# ---------- Top Bar (Title + Back Button) ---------- #}
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:12px;">
    <div>
      <h1 style="margin:0 0 4px;font-size:32px;font-weight:700;">Backups</h1>
      <p style="margin:0 0 20px;font-size:15px;color:#475569;">
        Create a full database backup or restore from a previous file. Use with care – restore can overwrite data.
      </p>
    </div>
    <div>
      <a href="{% url 'dashboard' %}"
         class="btn btn-secondary"
         style="display:inline-flex;align-items:center;justify-content:center;padding:10px 18px;min-width:170px;border-radius:999px;font-size:16px;font-weight:500;text-decoration:none;border:1px solid #d1d5db;cursor:pointer;white-space:nowrap;background:#0d6efd;color:#ffffff;">
        ← Back to Dashboard
      </a>
    </div>
  </div>

  {# ---------- Flash Messages ---------- #}
  {% if messages %}
    <div style="margin-bottom:18px;">
      {% for message in messages %}
        <div
          class="{% if message.tags == 'error' %}backup-msg-error{% else %}backup-msg-ok{% endif %}"
          style="padding:10px 12px;border-radius:10px;font-size:14px;margin-bottom:8px;">
          {{ message }}
        </div>
      {% endfor %}
    </div>

    <style>
      .backup-msg-error {
        background: #fee2e2;
        color: #b91c1c;
        border: 1px solid #fecaca;
      }
      .backup-msg-ok {
        background: #ecfdf3;
        color: #166534;
        border: 1px solid #bbf7d0;
      }
    </style>
  {% endif %}

  {# ---------- Create Backup Card ---------- #}
  <div style="background:#ffffff;border-radius:14px;border:1px solid #d1d5db;
              padding:18px 20px 20px;box-shadow:0 6px 18px rgba(15,23,42,0.06);
              margin-bottom:20px;">
    <div style="font-size:18px;font-weight:600;margin-bottom:6px;">
      Create backup
    </div>
    <p style="font-size:15px;color:#475569;margin-bottom:14px;">
      Click the button below to generate a backup of the current database.
      Your browser will download a <code>.json</code> file to your computer.
    </p>

    <form method="post" action="{% url 'create_backup' %}">
      {% csrf_token %}
      <button type="submit"
              class="btn btn-primary"
              style="display:inline-flex;align-items:center;justify-content:center;
                     padding:9px 18px;border-radius:999px;font-size:15px;font-weight:500;
                     border:1px solid #0d6efd;background:#0d6efd;color:#ffffff;
                     cursor:pointer;white-space:nowrap;">
        ⬇️ Create &amp; Download Backup
      </button>
    </form>
  </div>

  {# ---------- Restore Backup Card ---------- #}
  <div style="background:#ffffff;border-radius:14px;border:1px solid #d1d5db;
              padding:18px 20px 20px;box-shadow:0 6px 18px rgba(15,23,42,0.06);">
    <div style="font-size:18px;font-weight:600;margin-bottom:6px;">
      Restore from backup
    </div>
    <p style="font-size:15px;color:#475569;margin-bottom:10px;">
      Choose a backup <code>.json</code> file that was created from this system and restore it into the database.
      <span style="color:#b91c1c;font-weight:600;">Warning:</span>
      restoring may overwrite existing records, so only use files you trust.
    </p>

    <form method="post"
          action="{% url 'restore_backup' %}"
          enctype="multipart/form-data"
          style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end;">
      {% csrf_token %}
      <div style="flex:1;min-width:220px;">
        <label style="display:block;font-size:14px;margin-bottom:4px;">
          Backup file (.json)
        </label>
        <input type="file"
               name="backup_file"
               accept=".json"
               style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;background:#f9fafb;">
      </div>
      <div>
        <button type="submit"
                class="btn btn-secondary"
                style="display:inline-flex;align-items:center;justify-content:center;
                       padding:9px 18px;border-radius:999px;font-size:15px;font-weight:500;
                       border:1px solid #d1d5db;background:#f3f4f6;color:#111827;
                       cursor:pointer;white-space:nowrap;">
          ♻️ Restore Backup
        </button>
      </div>
    </form>
  </div>

</div>
{% endblock %}