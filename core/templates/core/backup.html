{% extends "core/base.html" %}

{% block title %}Backups{% endblock %}

{% block content %}
<div class="page backup-page">
  <style>
    .backup-page{
      max-width:980px;
      margin:34px auto 64px;
      padding:0 16px;
      --line:#e2e8f0;
      --ink-900:#0f172a;
      --ink-700:#334155;
      --ink-500:#64748b;
      --primary:#2563eb;
      --primary-dark:#1d4ed8;
      --panel:#ffffff;
      --soft:#f8fafc;
    }

    .backup-hero{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
      border:1px solid var(--line);
      border-radius:18px;
      padding:18px 20px;
      background:
        radial-gradient(900px 260px at -20% -120%, #dbeafe 0%, transparent 58%),
        radial-gradient(700px 220px at 120% -110%, #dcfce7 0%, transparent 56%),
        var(--panel);
      box-shadow:0 10px 24px rgba(15,23,42,.07);
      margin-bottom:18px;
    }

    .backup-kicker{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border-radius:999px;
      padding:5px 10px;
      border:1px solid #dbeafe;
      background:#eff6ff;
      color:#1d4ed8;
      font-size:12px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.08em;
      margin-bottom:8px;
    }

    .backup-title{
      margin:0 0 6px;
      font-size:31px;
      letter-spacing:-.02em;
      color:var(--ink-900);
      font-weight:800;
    }

    .backup-sub{
      margin:0;
      font-size:15px;
      color:#475569;
      line-height:1.55;
      max-width:720px;
    }

    .backup-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .backup-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      padding:10px 15px;
      border-radius:12px;
      font-size:14px;
      font-weight:700;
      border:1px solid #cbd5e1;
      background:#f8fafc;
      color:#0f172a;
      white-space:nowrap;
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      cursor:pointer;
    }

    .backup-btn:hover{
      transform:translateY(-1px);
      border-color:#94a3b8;
      box-shadow:0 8px 16px rgba(15,23,42,.08);
    }

    .backup-btn-primary{
      border-color:var(--primary-dark);
      background:linear-gradient(180deg,var(--primary),var(--primary-dark));
      color:#fff;
    }

    .backup-btn-primary:hover{
      box-shadow:0 12px 20px rgba(29,78,216,.22);
    }

    .backup-messages{
      margin-bottom:16px;
      display:grid;
      gap:8px;
    }

    .backup-message{
      padding:10px 12px;
      border-radius:10px;
      font-size:14px;
      font-weight:600;
      border:1px solid;
    }

    .backup-msg-error{
      background:#fee2e2;
      color:#b91c1c;
      border-color:#fecaca;
    }

    .backup-msg-ok{
      background:#ecfdf3;
      color:#166534;
      border-color:#bbf7d0;
    }

    .backup-card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(15,23,42,.06);
      padding:18px 20px 20px;
      margin-bottom:18px;
    }

    .backup-card-title{
      margin:0 0 6px;
      font-size:18px;
      font-weight:800;
      color:var(--ink-900);
    }

    .backup-card-sub{
      margin:0 0 14px;
      font-size:14px;
      color:#475569;
      line-height:1.55;
    }

    .backup-table-wrap{
      overflow-x:auto;
      border:1px solid #e5e7eb;
      border-radius:12px;
    }

    .backup-table{
      width:100%;
      min-width:660px;
      border-collapse:collapse;
      background:#fff;
    }

    .backup-table th,
    .backup-table td{
      padding:11px 10px;
      border-bottom:1px solid #f1f5f9;
      font-size:14px;
      vertical-align:middle;
    }

    .backup-table th{
      text-align:left;
      font-weight:700;
      color:var(--ink-500);
      background:#f8fafc;
      text-transform:uppercase;
      letter-spacing:.05em;
      font-size:12px;
    }

    .backup-table tbody tr:nth-child(even){ background:#fcfdff; }
    .backup-table tbody tr:hover{ background:#f8fbff; }

    .backup-file{
      color:var(--ink-900);
      font-weight:600;
    }

    .backup-muted{
      color:var(--ink-700);
      white-space:nowrap;
    }

    .backup-empty{
      padding:12px;
      border-radius:10px;
      background:var(--soft);
      border:1px solid var(--line);
      color:#334155;
      font-size:14px;
    }

    .restore-warning{
      margin:0 0 12px;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #fecaca;
      background:#fff1f2;
      color:#9f1239;
      font-size:13px;
      font-weight:600;
    }

    .restore-form{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:flex-end;
    }

    .restore-form .field{
      flex:1;
      min-width:240px;
    }

    .restore-form label{
      display:block;
      margin-bottom:5px;
      color:#334155;
      font-size:14px;
      font-weight:600;
    }

    .restore-form input[type="file"]{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      background:#f8fafc;
      font-size:14px;
    }

    @media (max-width: 640px){
      .backup-page{
        margin:24px auto 52px;
        padding:0 14px;
      }
      .backup-hero{
        padding:15px;
        border-radius:15px;
      }
      .backup-title{ font-size:25px; }
      .backup-btn{ width:100%; }
      .restore-form .field{ min-width:100%; }
    }
  </style>

  <div class="backup-hero">
    <div>
      <div class="backup-kicker">Data Safety</div>
      <h1 class="backup-title">Backups</h1>
      <p class="backup-sub">
        Create a full database backup or restore from a previous file. Use restore only when needed, because it may overwrite existing records.
      </p>
    </div>
    <div class="backup-actions">
      <a href="{% url 'dashboard' %}" class="backup-btn backup-btn-primary">‚Üê Back to Dashboard</a>
    </div>
  </div>

  {% if messages %}
    <div class="backup-messages">
      {% for message in messages %}
        <div class="backup-message {% if message.tags == 'error' %}backup-msg-error{% else %}backup-msg-ok{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="backup-card">
    <h2 class="backup-card-title">Create Backup</h2>
    <p class="backup-card-sub">
      Generate a new <code>.json</code> backup of your current database state. Backups are stored on the server and only the latest 3 are retained.
    </p>
    <form method="post" action="{% url 'create_backup' %}">
      {% csrf_token %}
      <button type="submit" class="backup-btn backup-btn-primary">üíæ Create Backup</button>
    </form>
  </div>

  <div class="backup-card">
    <h2 class="backup-card-title">Recent Backups</h2>
    <p class="backup-card-sub">
      Server-side backups for this company. Keep your own offline copies after downloading.
    </p>

    {% if backups %}
      <div class="backup-table-wrap">
        <table class="backup-table">
          <thead>
            <tr>
              <th>File</th>
              <th>Size</th>
              <th>Updated</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for b in backups %}
              <tr>
                <td class="backup-file">{{ b.name }}</td>
                <td class="backup-muted">{{ b.size }} bytes</td>
                <td class="backup-muted">{{ b.modified }}</td>
                <td>
                  <a href="{% url 'download_backup' b.name %}" class="backup-btn">‚¨áÔ∏è Download</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="backup-empty">No server backups found yet. Create your first backup above.</div>
    {% endif %}
  </div>

  <div class="backup-card">
    <h2 class="backup-card-title">Restore from Backup</h2>
    <p class="backup-card-sub">
      Upload a trusted <code>.json</code> backup file previously created from this system.
    </p>
    <p class="restore-warning">
      Warning: restore can overwrite existing records and should be used only after taking a fresh backup.
    </p>

    <form method="post" action="{% url 'restore_backup' %}" enctype="multipart/form-data" class="restore-form">
      {% csrf_token %}
      <div class="field">
        <label>Backup file (.json)</label>
        <input type="file" name="backup_file" accept=".json">
      </div>
      <div>
        <button type="submit" class="backup-btn">‚ôªÔ∏è Restore Backup</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
