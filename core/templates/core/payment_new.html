{% extends "core/base.html" %}

{% block title %}New Payment{% endblock %}

{% block content %}
<div class="page" style="max-width:1100px;margin:50px auto 80px;padding:0 32px;font-size:17px;line-height:1.45;">
  <style>
    @media (max-width:640px){
      .np-title{font-size:24px !important;}
      .np-sub{font-size:14px !important;}
      .np-btn{
        padding:10px 14px !important;
        font-size:14px !important;
        min-width:auto !important;
      }
      .np-grid{
        grid-template-columns:1fr !important;
        gap:14px !important;
      }
      .page{
        padding:0 16px !important;
      }
    }
  </style>

  {# ---------- Top Bar (Title + Dashboard + Back) ---------- #}
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:22px;flex-wrap:wrap;gap:12px;">
    <div>
      <h1 class="np-title" style="margin:0 0 6px;font-size:34px;font-weight:700;">
        <span data-i18n="new_payment_title">New Payment</span>
      </h1>
      <p class="np-sub" style="margin:0 0 20px;font-size:16px;color:#475569;" data-i18n="new_payment_sub">
        Record money received from customers or paid to suppliers using a cash or bank account.
      </p>
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;">
      <a href="{% url 'dashboard' %}"
        class="btn btn-secondary np-btn"
         style="display:inline-flex;align-items:center;justify-content:center;padding:10px 20px;min-width:170px;border-radius:999px;font-size:16px;font-weight:500;text-decoration:none;border:1px solid #d1d5db;cursor:pointer;white-space:nowrap;background:#f3f4f6;color:#111827;">
        <span data-i18n="back_dashboard">â† Dashboard</span>
      </a>
      <a href="{% url 'payment_list' %}"
        class="btn btn-secondary np-btn"
         style="display:inline-flex;align-items:center;justify-content:center;padding:10px 20px;min-width:190px;border-radius:999px;font-size:16px;font-weight:500;text-decoration:none;border:1px solid #0d6efd;cursor:pointer;white-space:nowrap;background:#0d6efd;color:#ffffff;">
        <span data-i18n="back_to_payments">â† Back to Payments</span>
      </a>
    </div>
  </div>

  {# ---------- Error Message (if any) ---------- #}
  {% if error %}
    <div style="margin-bottom:16px;padding:10px 12px;border-radius:10px;
                font-size:15px;background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;">
      {{ error }}
    </div>
  {% endif %}

  {# ---------- Card with Form ---------- #}
  <div style="background:#ffffff;border-radius:14px;border:1px solid #d1d5db;
              padding:22px 24px 24px;box-shadow:0 6px 18px rgba(15,23,42,0.06);">

    <form method="post">
      {% csrf_token %}

      <div class="np-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;">

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_date">Date</label>
          <input type="date"
                 name="date"
                 value="{{ today }}"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_direction">Direction</label>
          <div style="display:flex;flex-direction:column;gap:8px;font-size:16px;">
            <label>
              <input type="radio" name="direction" value="IN" checked>
              <span data-i18n="direction_in">Receipt (money coming IN)</span>
            </label>
            <label>
              <input type="radio" name="direction" value="OUT">
              <span data-i18n="direction_out">Payment (money going OUT)</span>
            </label>
          </div>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_party">
            Party (Customer / Supplier)
          </label>
          <select name="party" required
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <option value="" data-i18n="opt_select_party">-- Select Party --</option>
            {% for p in parties %}
              <option value="{{ p.id }}">{{ p.name }} ({{ p.get_party_type_display }})</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_account">
            Cash / Bank Account
          </label>
          <select name="account" required
                  style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;height:48px;">
            <option value="" data-i18n="opt_select_account">-- Select Account --</option>
            {% for acc in accounts %}
              <option value="{{ acc.id }}">{{ acc.code }} - {{ acc.name }}</option>
            {% endfor %}
          </select>
          <p style="margin:6px 0 0;font-size:14px;color:#6b7280;" data-i18n="account_help">
            Only accounts marked as Cash/Bank and allowed for payments are shown.
          </p>
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_amount">
            Amount (Rs)
          </label>
          <input type="number"
                 name="amount"
                 step="0.01"
                 min="0"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

        <div>
          <label style="display:block;font-size:15px;margin-bottom:6px;" data-i18n="label_description">
            Description (optional)
          </label>
          <input type="text"
                 name="description"
                 maxlength="255"
                 style="width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d1d5db;font-size:16px;">
        </div>

      </div>

      <div style="margin-top:22px;display:flex;gap:12px;flex-wrap:wrap;">
        <button type="submit"
              class="btn btn-primary np-btn"
                style="display:inline-flex;align-items:center;justify-content:center;padding:12px 22px;border-radius:999px;font-size:17px;font-weight:500;border:1px solid #0d6efd;background:#0d6efd;color:#ffffff;cursor:pointer;white-space:nowrap;">
          <span data-i18n="save_post">ğŸ’¾ Save &amp; Post</span>
        </button>
        <a href="{% url 'payment_list' %}"
          class="btn btn-secondary np-btn"
           style="display:inline-flex;align-items:center;justify-content:center;padding:12px 22px;border-radius:999px;font-size:17px;font-weight:500;border:1px solid #d1d5db;background:#f3f4f6;color:#111827;text-decoration:none;cursor:pointer;white-space:nowrap;">
          <span data-i18n="cancel">Cancel</span>
        </a>
      </div>

    </form>
  </div>

</div>

{# ==========================
   Urdu/English i18n (REGISTER ONLY; do not override base applyLang)
   ========================== #}
<script>
  window.ROZ_I18N = window.ROZ_I18N || { en: {}, ur: {} };

  Object.assign(window.ROZ_I18N.en, {
    new_payment_title: "New Payment",
    new_payment_sub: "Record money received from customers or paid to suppliers using a cash or bank account.",
    back_dashboard: "â† Dashboard",
    back_to_payments: "â† Back to Payments",
    label_date: "Date",
    label_direction: "Direction",
    direction_in: "Receipt (money coming IN)",
    direction_out: "Payment (money going OUT)",
    label_party: "Party (Customer / Supplier)",
    opt_select_party: "-- Select Party --",
    label_account: "Cash / Bank Account",
    opt_select_account: "-- Select Account --",
    account_help: "Only accounts marked as Cash/Bank and allowed for payments are shown.",
    label_amount: "Amount (Rs)",
    label_description: "Description (optional)",
    save_post: "ğŸ’¾ Save & Post",
    cancel: "Cancel"
  });

  Object.assign(window.ROZ_I18N.ur, {
    new_payment_title: "Ù†Ø¦ÛŒ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ / Ø±Ø³ÛŒØ¯",
    new_payment_sub: "Ú©ÛŒØ´ ÛŒØ§ Ø¨ÛŒÙ†Ú© Ø§Ú©Ø§Ø¤Ù†Ù¹ Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ú¯Ø§ÛÚ© Ø³Û’ ÙˆØµÙˆÙ„ Ø´Ø¯Û ÛŒØ§ Ø³Ù¾Ù„Ø§Ø¦Ø± Ú©Ùˆ Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒ Ø±Ù‚Ù… Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø±ÛŒÚºÛ”",
    back_dashboard: "â† ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ",
    back_to_payments: "â† Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒÙˆÚº Ù¾Ø± ÙˆØ§Ù¾Ø³",
    label_date: "ØªØ§Ø±ÛŒØ®",
    label_direction: "Ø³Ù…Øª",
    direction_in: "Ø±Ø³ÛŒØ¯ (Ø±Ù‚Ù… Ø§Ù†Ø¯Ø± Ø¢ Ø±ÛÛŒ ÛÛ’)",
    direction_out: "Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ (Ø±Ù‚Ù… Ø¨Ø§ÛØ± Ø¬Ø§ Ø±ÛÛŒ ÛÛ’)",
    label_party: "ÙØ±ÛŒÙ‚ (Ú¯Ø§ÛÚ© / Ø³Ù¾Ù„Ø§Ø¦Ø±)",
    opt_select_party: "-- ÙØ±ÛŒÙ‚ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --",
    label_account: "Ú©ÛŒØ´ / Ø¨ÛŒÙ†Ú© Ø§Ú©Ø§Ø¤Ù†Ù¹",
    opt_select_account: "-- Ø§Ú©Ø§Ø¤Ù†Ù¹ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --",
    account_help: "ØµØ±Ù ÙˆÛ Ø§Ú©Ø§Ø¤Ù†Ù¹Ø³ Ø¯Ú©Ú¾Ø§Ø¦Û’ Ø¬Ø§ØªÛ’ ÛÛŒÚº Ø¬Ùˆ Ú©ÛŒØ´/Ø¨ÛŒÙ†Ú© Ù…Ø§Ø±Ú© ÛÙˆÚº Ø§ÙˆØ± Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Û’ Ù„ÛŒÛ’ Ø§Ø¬Ø§Ø²Øª ÛŒØ§ÙØªÛ ÛÙˆÚºÛ”",
    label_amount: "Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)",
    label_description: "ØªÙØµÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)",
    save_post: "ğŸ’¾ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº Ø§ÙˆØ± Ù¾ÙˆØ³Ù¹ Ú©Ø±ÛŒÚº",
    cancel: "Ù…Ù†Ø³ÙˆØ® Ú©Ø±ÛŒÚº"
  });
</script>
{% endblock %}