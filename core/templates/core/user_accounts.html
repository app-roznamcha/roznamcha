{% extends "core/base.html" %}

{% block title %}Bank & Cash Accounts{% endblock %}

{% block content %}
<div class="page" style="max-width:900px;margin:40px auto 60px;padding:0 26px;">

  {# ---------- Top Bar ---------- #}
  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:18px;flex-wrap:wrap;gap:12px;">
    <div>
      <h1 style="margin:0 0 4px;font-size:32px;font-weight:700;">
        üè¶ Bank &amp; Cash Accounts
      </h1>
      <p style="margin:0 0 16px;font-size:15px;color:#475569;">
        Define accounts like <strong>HBL</strong>, <strong>Cash Counter</strong>,
        <strong>Easypaisa</strong>, etc. These will appear on
        <em>New Sale</em>, <em>New Purchase</em> and <em>New Payment</em> screens.
      </p>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <a href="{% url 'dashboard' %}"
         class="btn btn-secondary"
         style="display:inline-flex;align-items:center;justify-content:center;padding:9px 18px;min-width:140px;border-radius:999px;font-size:15px;font-weight:500;text-decoration:none;border:1px solid #d1d5db;cursor:pointer;white-space:nowrap;background:#f3f4f6;color:#111827;">
        ‚Üê Dashboard
      </a>
    </div>
  </div>

  {# ---------- Messages ---------- #}
  {% if error %}
    <div style="margin-bottom:14px;padding:10px 12px;border-radius:10px;
                font-size:14px;background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;">
      {{ error }}
    </div>
  {% endif %}
  {% if message %}
    <div style="margin-bottom:14px;padding:10px 12px;border-radius:10px;
                font-size:14px;background:#dcfce7;color:#166534;border:1px solid #bbf7d0;">
      {{ message }}
    </div>
  {% endif %}

  {# ---------- Add / Update Card ---------- #}
  <div style="background:#ffffff;border-radius:14px;border:1px solid #d1d5db;
              padding:18px 20px 20px;box-shadow:0 6px 18px rgba(15,23,42,0.06);
              margin-bottom:22px;">
    <div style="font-size:18px;font-weight:600;margin-bottom:8px;">
      Add / Update Account
    </div>
    <p style="margin:0 0 14px;font-size:14px;color:#6b7280;">
      Create a new bank or cash account. You can later adjust its code or name if required.
    </p>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="account_id" id="account_id">

      <div style="display:flex;flex-wrap:wrap;gap:16px;margin-bottom:10px;">
        <div style="flex:1 1 180px;min-width:220px;max-width:260px;">
          <label for="code" style="display:block;font-size:14px;margin-bottom:4px;">
            Code
          </label>
          <input type="text"
                 name="code"
                 id="code"
                 required
                 placeholder="e.g. HBL01, CASH1"
                 style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;">
          <div style="font-size:12px;color:#6b7280;margin-top:3px;">
            Short unique code for this account.
          </div>
        </div>

              <!-- Opening balance for NEW accounts (optional) -->
      <div style="display:flex;flex-wrap:wrap;gap:16px;margin-bottom:10px;">
        <div style="flex:1 1 180px;min-width:220px;max-width:260px;">
          <label for="opening_amount" style="display:block;font-size:14px;margin-bottom:4px;">
            Opening Balance (optional)
          </label>
          <input type="number"
                 step="0.01"
                 name="opening_amount"
                 id="opening_amount"
                 placeholder="e.g. 50000.00"
                 style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;">
          <div style="font-size:12px;color:#6b7280;margin-top:3px;">
            Leave blank for zero. Applied only when creating a new account.
          </div>
        </div>

        <div style="flex:0 0 140px;min-width:140px;">
          <label for="opening_side" style="display:block;font-size:14px;margin-bottom:4px;">
            Dr / Cr
          </label>
          <select name="opening_side"
                  id="opening_side"
                  style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;">
            <option value="DEBIT" selected>Debit (positive balance)</option>
            <option value="CREDIT">Credit (overdraft)</option>
          </select>
        </div>
      </div>

        <div style="flex:2 1 260px;min-width:260px;">
          <label for="name" style="display:block;font-size:14px;margin-bottom:4px;">
            Account Name
          </label>
          <input type="text"
                 name="name"
                 id="name"
                 required
                 placeholder="e.g. HBL Main Branch, Easypaisa Wallet"
                 style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;">
        </div>


      </div>

      <button type="submit"
              class="btn-primary"
              style="display:inline-flex;align-items:center;justify-content:center;padding:9px 18px;border-radius:999px;font-size:15px;font-weight:500;border:1px solid #0d6efd;background:#0d6efd;color:#ffffff;cursor:pointer;white-space:nowrap;">
        üíæ Save Account
      </button>
    </form>
  </div>

  {# ---------- Existing Accounts Card ---------- #}
  <div style="background:#ffffff;border-radius:14px;border:1px solid #d1d5db;
              padding:18px 20px 20px;box-shadow:0 6px 18px rgba(15,23,42,0.06);">
    <div style="font-size:18px;font-weight:600;margin-bottom:8px;">
      Existing Bank &amp; Cash Accounts
    </div>
    <p style="margin:0 0 12px;font-size:14px;color:#6b7280;">
      These accounts will appear when recording receipts, payments, purchases and sales.
    </p>

    <div style="width:100%;overflow-x:auto;">
      <table style="border-collapse:collapse;width:100%;min-width:650px;">
        <thead>
          <tr>
            <th style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;background:#f9fafb;text-align:left;font-weight:600;width:13%;">
              Code
            </th>
            <th style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;background:#f9fafb;text-align:left;font-weight:600;">
              Name
            </th>
            <th style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;background:#f9fafb;text-align:left;font-weight:600;width:15%;">
              Type
            </th>
            <th style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;background:#f9fafb;text-align:center;font-weight:600;width:18%;">
              Used for Payments?
            </th>
            <th style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;background:#f9fafb;text-align:center;font-weight:600;width:12%;">
              Action
            </th>
          </tr>
        </thead>
        <tbody>
        {% for acc in accounts %}
          <tr>
            <td style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;">
              {{ acc.code }}
            </td>
            <td style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;">
              {{ acc.name }}
            </td>
            <td style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;">
              {{ acc.get_account_type_display }}
            </td>
            <td style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:15px;text-align:center;">
              {% if acc.allow_for_payments %}
                <span style="display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#dcfce7;color:#166534;">
                  Yes
                </span>
              {% else %}
                <span style="display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#fee2e2;color:#b91c1c;">
                  No
                </span>
              {% endif %}
            </td>
            <td style="border-bottom:1px solid #e5e7eb;padding:7px 9px;font-size:14px;text-align:center;">
              <form method="post"
                    action="{% url 'user_account_delete' acc.id %}"
                    style="display:inline;margin:0;">
                {% csrf_token %}
                <button type="submit"
                        title="Delete account"
                        onclick="return confirm('Delete {{ acc.code }} ‚Äì {{ acc.name }}?\n\nIf this account is used in transactions, deletion will be blocked.');"
                        style="border:none;background:none;color:#b91c1c;font-size:13px;
                               text-decoration:underline;cursor:pointer;padding:0;">
                  Delete
                </button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5"
                style="border-bottom:1px solid #e5e7eb;padding:10px 9px;font-size:15px;color:#6b7280;">
              No bank/cash accounts defined yet.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}