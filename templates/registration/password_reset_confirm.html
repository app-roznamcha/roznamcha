{% extends "core/base.html" %}
{% block title %}Set New Password{% endblock %}

{% block content %}
<div class="container" style="max-width: 980px; margin: 34px auto; padding: 0 14px;">

  <div style="
    max-width:620px;margin:0 auto;
    background:rgba(255,255,255,.92);
    border:1px solid #e5e7eb;border-radius:20px;
    padding:22px;
    box-shadow:0 18px 34px rgba(15,23,42,.10);
  ">

    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;">
      <div style="min-width:240px;">
        <h2 style="margin:0 0 6px;font-size:30px;letter-spacing:-.02em;font-weight:900;color:#0f172a;">
          Set New Password
        </h2>
        <p style="margin:0;color:#64748b;line-height:1.55;font-size:14px;">
          Choose a strong password you don’t use elsewhere.
        </p>
      </div>

      <a href="{% url 'login' %}" style="
        display:inline-flex;align-items:center;justify-content:center;
        padding:10px 14px;border-radius:999px;
        border:1px solid #e5e7eb;background:#fff;
        font-weight:900;color:#0f172a;font-size:13px;white-space:nowrap;
      ">
        ← Back to Login
      </a>
    </div>

    <div style="height:14px;"></div>

    {% if validlink %}

      {% if form.non_field_errors %}
        <div style="background:#fff1f2;border:1px solid #fecdd3;color:#9f1239;padding:10px 12px;border-radius:14px;margin:12px 0;font-weight:700;">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      {% if form.errors %}
        <div style="background:#fffbeb;border:1px solid #fde68a;color:#92400e;padding:10px 12px;border-radius:14px;margin:12px 0;">
          <div style="font-weight:900;margin-bottom:6px;">Please fix the errors below:</div>
          <ul style="margin:0;padding-left:18px;line-height:1.6;">
            {% for field in form %}
              {% for error in field.errors %}
                <li><b>{{ field.label }}:</b> {{ error }}</li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form method="post" style="margin:0;">
        {% csrf_token %}

        <div style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px;">

          <!-- New password -->
          <div>
            <label for="id_new_password1" style="font-weight:900;color:#0f172a;display:block;margin-bottom:6px;">
              New password
            </label>

            <div style="display:flex;gap:10px;align-items:center;">
              <input
                id="id_new_password1"
                name="new_password1"
                type="password"
                autocomplete="new-password"
                required
                value="{{ form.new_password1.value|default_if_none:'' }}"
                style="
                  flex:1;
                  width:100%;
                  padding:12px 12px;
                  border:1px solid #e5e7eb;border-radius:14px;
                  background:#fff;
                  outline:none;
                  font-size:16px;
                "
              />
              <button type="button" data-toggle="id_new_password1" style="
                padding:10px 12px;border-radius:12px;
                border:1px solid #e5e7eb;background:#fff;
                font-weight:900;font-size:13px;cursor:pointer;
                white-space:nowrap;
              ">Show</button>
            </div>

            {% if form.new_password1.help_text %}
              <div style="margin-top:6px;color:#64748b;font-size:12px;line-height:1.45;">
                {{ form.new_password1.help_text|safe }}
              </div>
            {% endif %}
          </div>

          <!-- Confirm password -->
          <div>
            <label for="id_new_password2" style="font-weight:900;color:#0f172a;display:block;margin-bottom:6px;">
              Confirm new password
            </label>

            <div style="display:flex;gap:10px;align-items:center;">
              <input
                id="id_new_password2"
                name="new_password2"
                type="password"
                autocomplete="new-password"
                required
                value="{{ form.new_password2.value|default_if_none:'' }}"
                style="
                  flex:1;
                  width:100%;
                  padding:12px 12px;
                  border:1px solid #e5e7eb;border-radius:14px;
                  background:#fff;
                  outline:none;
                  font-size:16px;
                "
              />
              <button type="button" data-toggle="id_new_password2" style="
                padding:10px 12px;border-radius:12px;
                border:1px solid #e5e7eb;background:#fff;
                font-weight:900;font-size:13px;cursor:pointer;
                white-space:nowrap;
              ">Show</button>
            </div>
          </div>

          <button type="submit" style="
            margin-top:6px;
            width:100%;
            padding:13px 16px;
            border-radius:999px;
            border:1px solid #2563eb;
            background:#2563eb;
            color:#fff;
            font-weight:900;
            cursor:pointer;
            font-size:15px;
            box-shadow:0 14px 26px rgba(37,99,235,.18);
          ">
            Update Password
          </button>

        </div>
      </form>

    {% else %}
      <div style="background:#fff1f2;border:1px solid #fecdd3;color:#9f1239;padding:12px 14px;border-radius:14px;margin-top:14px;">
        <div style="font-weight:900;margin-bottom:6px;">This link is invalid or expired.</div>
        <div style="color:#9f1239;opacity:.9;">Please request a new password reset link.</div>
      </div>

      <a href="{% url 'password_reset' %}" style="
        margin-top:14px;
        display:inline-flex;align-items:center;justify-content:center;
        width:100%;
        padding:13px 16px;
        border-radius:999px;
        border:1px solid #2563eb;
        background:#2563eb;color:#fff;
        font-weight:900;
        box-shadow:0 14px 26px rgba(37,99,235,.18);
      ">
        Request New Link
      </a>
    {% endif %}

  </div>
</div>

<script>
  (function () {
    const btns = document.querySelectorAll("button[data-toggle]");
    btns.forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-toggle");
        const el = document.getElementById(id);
        if (!el) return;
        const isPwd = el.getAttribute("type") === "password";
        el.setAttribute("type", isPwd ? "text" : "password");
        btn.textContent = isPwd ? "Hide" : "Show";
      });
    });
  })();
</script>
{% endblock %}